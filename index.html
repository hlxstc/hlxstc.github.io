<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="hlxstc680@gmail.com">
<meta property="og:type" content="website">
<meta property="og:title" content="Jokers&#39;s Blog">
<meta property="og:url" content="http://thathub.com/index.html">
<meta property="og:site_name" content="Jokers&#39;s Blog">
<meta property="og:description" content="hlxstc680@gmail.com">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jokers&#39;s Blog">
<meta name="twitter:description" content="hlxstc680@gmail.com">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://thathub.com/"/>





  <title>Jokers's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jokers's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">高尚是高尚者的墓志铭 卑鄙是卑鄙者的通行证</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/07/25/python-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/25/python-install/" itemprop="url">Python3安装的坑</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-25T21:30:00+08:00">
                2019-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index">
                    <span itemprop="name">Tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/25/python-install/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/25/python-install/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装Python3前的必要准备工作"><a href="#安装Python3前的必要准备工作" class="headerlink" title="安装Python3前的必要准备工作"></a>安装Python3前的必要准备工作</h2><p>今天在自己的外网服务器安装Pandas后,尝试导入,报错:</p>
<pre><code>/usr/local/lib/python3.7/site-packages/pandas/io/common.py in &lt;module&gt;
      7 from http.client import HTTPException  # noqa
      8 from io import BytesIO
----&gt; 9 import lzma
     10 import mmap
     11 import os

/usr/local/lib/python3.7/lzma.py in &lt;module&gt;
     25 import io
     26 import os
---&gt; 27 from _lzma import *
     28 from _lzma import _encode_filter_properties, _decode_filter_properties
     29 import _compression

ModuleNotFoundError: No module named &apos;_lzma&apos;
</code></pre><h3 id="解决方法一"><a href="#解决方法一" class="headerlink" title="解决方法一"></a>解决方法一</h3><p><a href="https://www.jianshu.com/p/198620bbc5a0" target="_blank" rel="noopener">https://www.jianshu.com/p/198620bbc5a0</a></p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>根本原因在于安装Python3前，系统缺少必要的环境</p>
<pre><code># 解决 _lzma 缺失提醒
yum install xz-devel
</code></pre><p>现摘抄<a href="https://segmentfault.com/a/1190000017313144" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017313144</a>如下:</p>
<pre><code># wget 用于下载源码包
# gcc 和 make 用于编译
yum install wget gcc make

#make报错，Python 有个很重要的内建模块 zipimport 用于从 Zip 压缩包中导入模块
#zipimport.ZipImportError: can&apos;t decompress data; zlib not available
yum install zlib-devel

#make install报错，
#ModuleNotFoundError: No module named ‘_ctypes’
yum install libffi-devel

# 解决 import ssl 报错 No module named &apos;_ssl&apos;
yum install openssl-devel

# 解决 import bz2 报错
yum install  bzip2-devel

# 解决 import curses 报错
yum install  ncurses-devel

# 解决 import sqlite3 报错
yum install sqlite-devel

# 解决 _dbm _gdbm 缺失提醒
yum install gdbm-devel

# 解决 _lzma 缺失提醒
yum install xz-devel

# 解决 _tkinter 缺失提醒
yum install tk-devel

# 解决 readline 缺失提醒及方向键行为非预期的问题
yum install readline-devel
</code></pre><p>最后重新编译安装Pytho3</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/07/18/ML/applied_machine_learning_in_python_w2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/18/ML/applied_machine_learning_in_python_w2/" itemprop="url">Applied Machine Learning in Python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-18T22:30:00+08:00">
                2019-07-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/machine-learning/" itemprop="url" rel="index">
                    <span itemprop="name">machine learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/18/ML/applied_machine_learning_in_python_w2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/18/ML/applied_machine_learning_in_python_w2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Supervised-Machine-Learning"><a href="#Supervised-Machine-Learning" class="headerlink" title="Supervised Machine Learning"></a>Supervised Machine Learning</h2><h3 id="Overfitting-and-Underfitting"><a href="#Overfitting-and-Underfitting" class="headerlink" title="Overfitting and Underfitting"></a>Overfitting and Underfitting</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/07/16/ML/applied_machine_learning_in_python_w1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/16/ML/applied_machine_learning_in_python_w1/" itemprop="url">Applied Machine Learning in Python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-16T22:30:00+08:00">
                2019-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/machine-learning/" itemprop="url" rel="index">
                    <span itemprop="name">machine learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/16/ML/applied_machine_learning_in_python_w1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/16/ML/applied_machine_learning_in_python_w1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p>手工编写程序和一系列的规则并不能有效的解决所有我问题。例如精确的将人类对话转换成文本。<br>手写规则识别音频信号的一部分并决定那些单词出现在信号中是一项庞大的任务，识别不同语音时显得不够灵活和稳定。<br>如果我们要识别新的单词和特征，需要编写新的规则。<br>机器学习可以通过打标签的训练数据集自动学习复杂的规则，比起手动编写规则更加精确和灵活。<br>机器学习主要的目标是正确的预测或识别新的不在训练集中的对象。<br>搜索引擎利用机器学习对你的输入进行自动补全，还可以对查询结果进行排序。搜索引擎还通过你点击的页面和在页面停留的时间改善查询结果。<br>电影推荐系统使用机器学习和你过去的观看历史预测你的喜好以及和你喜好相似的其他人群。<br>图像和语音识别由于机器学习获得了巨大的发展。目前的识别技术已经足够可靠和快速，广泛的应用在语音控制等方面。<br>其他的应用还有，邮件分类、自动驾驶、医学应用等。</p>
<h2 id="Key-Concepts-in-Machine-Learning"><a href="#Key-Concepts-in-Machine-Learning" class="headerlink" title="Key Concepts in Machine Learning"></a>Key Concepts in Machine Learning</h2><p>机器学习可以分为两种类型。<br>第一种是监督学习，目标是预测和输入相关的输出变量。<br>如果输出是有限的可能，例如语音信号对应的单词，我们称这种监督学习为分类。<br>如果输出是实数，例如预测一辆车从0km/h加速到100km/h所需要的时间，我们称为回归。<br>监督学习需要打标的对象作为训练集，而通常标签是人工判断。<br>第二种是非监督学习，将数据分为集群或组。例如购物网站将用户分组，可以向不同组的用户推荐不同的商品，使得用户获得更好的体验。<br>另外一种重要的非监督学习类型是异常值检测，例如检测出对网站的攻击。<br>使用分类有三个基本步骤，第一步是将数据表示为计算机可以理解的东西（特征值表示）和选择分类方法。例如将图片表示为像素数组。第二步是确定评估方法，用来比较不同分类方法对特定问题的表现。第三步是迭代的选择参数并执行分类，使用评估方法寻找最优解。</p>
<h2 id="Python-Tools-for-Machine-Learning"><a href="#Python-Tools-for-Machine-Learning" class="headerlink" title="Python Tools for Machine Learning"></a>Python Tools for Machine Learning</h2><p>Scikit-learn是我们用于机器学习最主要的库，它基于另外两个Python科学计算库，分别为Scipy和Numpy。<br>Scipy包含分布统计，方法优化，线性代数和数学方法。我们将使用Scipy的稀疏矩阵储存包含大量0的表。<br>Numpy包含许多基础数据结构，例如多维矩阵。<br>Pandas用于数据操作和分析，我们将使用DateFrame，不像Numpy一样，它的每一列可以是不同的数据类型。<br>Matplotlib是二维绘图工具。</p>
<h2 id="An-Example-Machine-Learning-Problem"><a href="#An-Example-Machine-Learning-Problem" class="headerlink" title="An Example Machine Learning Problem"></a>An Example Machine Learning Problem</h2><p>我们准备构建一个简单的水果识别系统。<br>首先加载数据集</p>
<pre><code>%matplotlib notebook
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from sklearn.model_selection import train_test_split

fruits = pd.read_csv(&apos;fruit_data_with_colors.txt&apos;, sep=&apos;\t&apos;)
</code></pre><p>将数据集分成训练集和测试集，Scikit-learn提供了一个简单方法去分割数据集，这个方法随机挑选一定比例的数据子集作为训练集，75-25%是比较好的分割标准。</p>
<pre><code>x = fruits[[&apos;mass&apos;, &apos;width&apos;, &apos;height&apos;]]
y = fruits[[&apos;fruit_label&apos;]]
x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=0)
</code></pre><p>不同的random_state值会分割成不同的随机数据集。</p>
<h2 id="Examining-the-Data"><a href="#Examining-the-Data" class="headerlink" title="Examining the Data"></a>Examining the Data</h2><p>在训练之前，根据可视化的图例，我们可以知道每个特征值的取值范围，并发现异常值。通过观察不同类型对象在特征值空间表现的聚合和分离程度，我们可以大体了解机器学习预测的准确性。</p>
<p>下面我们将使用特征对图例的可视化工具，画出所有特征对的散点图，显示特征值的相关性。沿对角线的直方图显示特征值的分布。</p>
<pre><code>from matplotlib import cm
cmap = cm.get_cmap(&apos;gnuplot&apos;)
scatter = pd.plotting.scatter_matrix(x_train, c=y_train.fruit_label, marker=&apos;o&apos;, s=40, hist_kwds={&apos;bins&apos;:15}, figsize=(12, 12))
</code></pre><p>我们可以构建三维空间的特征值散点图</p>
<pre><code>from mpl_toolkits.mplot3d import Axes3D
fig = plt.figure()
ax = fig.add_subplot(111, projection=&apos;3d&apos;)
ax.scatter(x_train[&apos;width&apos;], x_train[&apos;height&apos;], x_train[&apos;mass&apos;], c=y_train.fruit_label, marker=&apos;o&apos;, s=100)
ax.set_xlabel(&apos;width&apos;)
ax.set_ylabel(&apos;height&apos;)
ax.set_zlabel(&apos;mass&apos;)
plt.show()
</code></pre><h2 id="K-Nearest-Neighbors-Classification"><a href="#K-Nearest-Neighbors-Classification" class="headerlink" title="K-Nearest Neighbors Classification"></a>K-Nearest Neighbors Classification</h2><p>又称为为K-NN，查找和预测对象距离最近的训练集中K个元素。更具一定规则决定预测对象的label。<br>k=1，过拟合。<br>k=N（the number of points），所有新对象的预测结果都是训练集中数量最多的类型。</p>
<p>创建分类器对象</p>
<pre><code>from sklearn.neighbors import KNeighborsClassifier
knn = KNeighborsClassifier(n_neighbors=5)

lookup_fruit_name = dict(zip(fruits.fruit_label, fruits.fruit_name))
</code></pre><p>使用分类器fit方法训练数据集。</p>
<pre><code>knn.fit(x_train, y_train.fruit_label)
</code></pre><p>在测试集上计算精确度，使用score方法</p>
<pre><code>knn.score(x_test, y_test.fruit_label)
</code></pre><p>使用训练后的k-NN分类器模型去分类新的对象</p>
<pre><code>fruit_prediction = knn.predict([[20, 4.3, 5.5]])
lookup_fruit_name[fruit_prediction[0]]
</code></pre><p>画出K-NN分类器的决策边界</p>
<pre><code>plot_fruit_knn(x_train, y_train.fruit_label, 5, &apos;uniform&apos;)
</code></pre><p>可以改变K值观察k对决策边界的影响。’uniform’参数，代表平等的对待所有的邻近结点，可以使用’distance’或者自定义方法。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/07/07/bigdata/Comparison_with_Traditional_Databases/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/07/bigdata/Comparison_with_Traditional_Databases/" itemprop="url">Comparison with Traditional Databases</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-07T17:35:00+08:00">
                2019-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/07/bigdata/Comparison_with_Traditional_Databases/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/07/bigdata/Comparison_with_Traditional_Databases/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>译自 Hadoop-The Definitive Guide, 4th Edition p476 </p>
</blockquote>
<h3 id="Schema-on-Read-Versus-Schema-on-Write"><a href="#Schema-on-Read-Versus-Schema-on-Write" class="headerlink" title="Schema on Read Versus Schema on Write"></a>Schema on Read Versus Schema on Write</h3><p>传统数据库在数据载入的时候会强制验证表的模式。<br>Hive只有在查询数据时才会验证。</p>
<p>Schema on Read 在数据初始载入时非常快，只是复制和移动数据不需要按照数据库的格式进行解析序列化。因此我们可以将两类模式应用在同一组数据。</p>
<p>Schema on Write 索引载入的数据使得查询更快，但是会耗费更长的时间载入</p>
<h3 id="Updates-Transactions-and-Indexes"><a href="#Updates-Transactions-and-Indexes" class="headerlink" title="Updates, Transactions, and Indexes"></a>Updates, Transactions, and Indexes</h3><p>Hive不支持就地更新，所以所有的增删该储存在临时表，然后定期合并到表</p>
<p>Hive支持分区级和表级锁</p>
<p>Hive的index可以提升查询速度，目前有两种索引：compact and bitmap<br>compact存储每个值对应block的标号<br>bitmap适用于索引低基数列(例如性别或国家)</p>
<h3 id="SQL-on-Hadoop-Alternatives"><a href="#SQL-on-Hadoop-Alternatives" class="headerlink" title="SQL-on-Hadoop Alternatives"></a>SQL-on-Hadoop Alternatives</h3><p>其他的SQL-on-Hadoop框架例如Impala、Presto、Drill、Spark SQL<br>Apache Phoenix 使用完全不同方法：将查询转换为HBase扫描，Metadata也存储在HBase。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/07/07/bigdata/HBase_Versus_RDBMS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/07/bigdata/HBase_Versus_RDBMS/" itemprop="url">HBase Versus RDBMS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-07T17:35:00+08:00">
                2019-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/07/bigdata/HBase_Versus_RDBMS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/07/bigdata/HBase_Versus_RDBMS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>HBase是分布式的面向列的数据存储系统，基于HDFS，提供Hadoop不具备的随即读写。<br>它的的设计专注于在横向和纵向的表扩展，可以达到数十亿行，数百万列的规模，可以水平分区并在数千个结点自动复制。<br>表的设计模式直接映射物理存储。</p>
<p>典型的RDMS是固定模式，面向行且具有复杂SQL查询的引擎，可以轻松建立索引，执行复杂的join和count、sum、sort、group等。<br>MySQL，innodb最大列数限制为1024，有些为4096</p>
<p>RDBMS适用于中小型的应用，如果需要扩展数据集或者并发读写，就会遇到巨大的性能问题和内在的分布式困难。<br>RDBMS的扩展需要涉及到打破Codd的规则和损失部分ACID限制，也就损失了那些使得RDBMS便利的特性。</p>
<h3 id="RDBMS"><a href="#RDBMS" class="headerlink" title="RDBMS"></a>RDBMS</h3><p>ACID（数据库事务正确执行的四个基本要素的缩写）</p>
<ul>
<li><p>如果读的请求太多</p>
<p>  添加Redis</p>
</li>
<li><p>如果写的请求过多</p>
<p>  购买服务器垂直扩展</p>
</li>
<li><p>太多的JOIN</p>
<p>  Denormalize数据减少JOIN，比如增加冗余字段</p>
</li>
<li><p>运算变慢</p>
<p>  停止作任何服务器端的计算</p>
</li>
<li><p>一些查询依然很慢</p>
<p>  预先实现一些复杂的查询</p>
</li>
<li><p>写入变慢</p>
<p>  删除二级索引</p>
</li>
</ul>
<h3 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h3><ul>
<li><p>没有真正的索引</p>
<p>  行和列按顺序存储，插入性能不受表的大小影响</p>
</li>
<li><p>自动分区</p>
<p>  自动分成regions并distribute到可用结点</p>
</li>
<li><p>容错能力</p>
</li>
<li><p>批量操作</p>
<p>  MapReduce的集成允许对数据进行完全并行的分布式作业</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/07/07/bigdata/Stop_Worrying_about_Solr_vs_Elasticsearch_Decisions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/07/bigdata/Stop_Worrying_about_Solr_vs_Elasticsearch_Decisions/" itemprop="url">停止担心关于Solr和Elasticsearch使用决策</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-07T10:00:00+08:00">
                2019-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/07/bigdata/Stop_Worrying_about_Solr_vs_Elasticsearch_Decisions/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/07/bigdata/Stop_Worrying_about_Solr_vs_Elasticsearch_Decisions/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>RE:<a href="https://opensourceconnections.com/blog/2019/02/28/stop-worrying-solr-elasticsearch/" target="_blank" rel="noopener">Stop Worrying about Solr vs Elasticsearch Decisions</a></p>
<p>有人说Luncene是引擎，Solr和Elasticsearch是车，选择Solr还是ES就像选车。但实际上选择搜索引擎不是选车，它们只是一堆原始的零件、车轮和一个引擎，需要你去组装它。</p>
<p>人们究竟如何使用Solr和ES：</p>
<ol>
<li><p>工程师的配置技巧是决定搜索引擎好坏关键性因素。ES可参考官方配置说明，翻译版在我的博客(<a href="http://thathub.com/2018/04/23/bigdata/elastcsearch-config/">http://thathub.com/2018/04/23/bigdata/elastcsearch-config/</a>)</p>
</li>
<li><p>写插件，扩展搜索引擎的功能</p>
</li>
<li><p>花费更多的时间在实验上，而不是特定的搜索引擎</p>
</li>
</ol>
<p>我们究竟要比较什么</p>
<p>我们更因该关注的是社区而不是功能。</p>
<ul>
<li><p>solr来自于Apache Software Foundation (ASF)。ASF希望个人和团体去定义产品的发展方向。Solr使得开发者有更多的机会去深入研究源码。</p>
</li>
<li><p>ES是由公司一个公司去主导的。虽然开发者没有主导权，但是对很多人来说，最需要的是”just work”。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/04/23/linux/error_relocation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/23/linux/error_relocation/" itemprop="url">GLIB出错</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-23T14:26:00+08:00">
                2019-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/23/linux/error_relocation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/04/23/linux/error_relocation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="事故描述"><a href="#事故描述" class="headerlink" title="事故描述"></a>事故描述</h3><blockquote>
<blockquote>
<p>relocation error: /lib64/libc.so.6: symbol _ dl_find_dso_for_object, version GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time reference</p>
</blockquote>
</blockquote>
<p>线上服务器被我玩坏了，紧张的要跑路了。执行所有基本命令都报以上错误。原因是自己手贱改了 /lib64/libc.so.6 的软链。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>出现这种问题，千万不要关闭shell，因为除了你现有的shell，没有人能登进来了。</li>
<li>出于同样的道理，不要重启服务器。</li>
</ol>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><pre><code># ldconfig (注意是 ‘l‘ 不是 ‘i‘ )
</code></pre><p>主要功能：在默认搜寻目录/lib和/usr/lib以及动态库配置文件/etc/ld.so.conf内所列的目录下，搜索出可共享的动态链接库（格式如lib.so）,进而创建出动态装入程序(ld.so)所需的连接和缓存文件。</p>
<p>感激涕零：<br><a href="https://www.jianshu.com/p/5ea4e50bf800" target="_blank" rel="noopener">https://www.jianshu.com/p/5ea4e50bf800</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/04/01/bigdata/mongondb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/01/bigdata/mongondb/" itemprop="url">MongoDB</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-01T17:00:00+08:00">
                2019-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/01/bigdata/mongondb/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/04/01/bigdata/mongondb/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>MongoDB 是一个面向文档（document-oriented）的数据库。</li>
<li>不再有预定义模式（predefined schema）：文档的键（key）和值（value）不再是固定的类型和大小。</li>
<li>MongoDB 能自动处理跨集群的数据和负载，自动重新分配文档，以及将用户请求路由到正确的机器上。</li>
<li>MongoDB 并不具备一些在关系型数据库中很普遍的功能，如连接（join）和复杂的多行事务（multirow transaction）。省略这些功能是出于架构上的考虑（为了得到更好的扩展性），因为在分布式系统中这两个功能难以高效地实现。</li>
<li>MongoDB 把尽可能多的内存用作缓存（cache），试图为每次查询自动选择正确的索引。</li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="文档–-gt-行"><a href="#文档–-gt-行" class="headerlink" title="文档–&gt;行"></a>文档–&gt;行</h3><ul>
<li>是键值对的一个有序集</li>
</ul>
<h3 id="集合–-gt-表"><a href="#集合–-gt-表" class="headerlink" title="集合–&gt;表"></a>集合–&gt;表</h3><ul>
<li>组织集合的一种惯例是使用“.”分隔不同命名空间的子集合。</li>
</ul>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><ul>
<li>多个文档组成集合，而多个集合可以组成数据库。</li>
<li>MongoDB 的一个实例可以拥有多个相互独立的数据库（database），每一个数据库都拥有自己的集合。</li>
<li>按照经验，我们将有关一个应用程序的所有数据都存储在同一个数据库中。</li>
<li>把数据库名添加到集合名前，得到集合的完全限定名，即命名空间（namespace）。</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre><code>sudo yum install mongodb mongodb-server
</code></pre><ul>
<li><p>mongod 还会启动一个非常基本的 HTTP 服务器，监听数字比主端口号高 1000 的端口，也就是 28017 端口。这意味着，通过浏览器访问 <a href="http://localhost:28017，能获取数据库的管理信息。" target="_blank" rel="noopener">http://localhost:28017，能获取数据库的管理信息。</a></p>
</li>
<li><p>启动配置</p>
<pre><code>sudo vim /etc/mongod.conf
&lt;!-- 配置后台启动 --&gt;
fork = true
</code></pre></li>
<li><p>启动<br>使用 -f 或 –config 标记，告知服务器使用配置文件</p>
<pre><code>mongod --config /etc/mongod.conf
mongod -f /etc/mongod.conf
</code></pre></li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>MongoDB的文档类似于JSON。JSON只有 null 、布尔、数字、字符串、数组和对象这几种数据类型。没有日期类型。仅有一种数字类型，不能区分浮点数和整数，不能区分32位和64位。没有正则或函数等。MongoDB添加了一些其他类型。</p>
<ul>
<li><p>null</p>
</li>
<li><p>布尔型 true false</p>
</li>
<li><p>数值<br>默认64位浮点型。整型可用NumberInt(4字节带符号整数),NumberLong(8字节带符号整数)。</p>
</li>
<li><p>字符串</p>
</li>
<li><p>日期<br>日期被存储为自新纪元以来经过的毫秒数,不存储时区</p>
</li>
<li><p>正则<br>语法也与 JavaScript 的正则表达式语法相同</p>
<pre><code>{&quot;x&quot; : /foobar/i}
</code></pre></li>
<li><p>数组<br>数组可包含不同数据类型的元素。</p>
<pre><code>{&quot;things&quot; : [&quot;pie&quot;, 3.14]}
</code></pre><blockquote>
<p>MongoDB 可以查询出 “things” 数组中包含 3.14这个元素的所有文档。要是经常使用这个查询,可以对 “things” 创建索引来提高性能。</p>
<p>MongoDB 可以使用原子更新对数组内容进行修改,比如深入数组内部将 pie 改为<br>  pi。</p>
</blockquote>
</li>
<li><p>内嵌文档</p>
<pre><code>{&quot;x&quot; : {&quot;foo&quot; : &quot;bar&quot;}}
</code></pre></li>
<li><p>ObjectId<br>不同的机器都能用全局唯一的同种方法方便地生成它。在多个服务器上同步自动增加主键值既费力又费时。所以能够在分片环境中生成唯一的标示符非常重要。12字节。</p>
<pre><code>0 1 2 3  4 5 6  7 8  9 10 11
时间戳    机器    PID  计数器

{&quot;x&quot; : ObjectId()}
</code></pre></li>
<li><p>自动生成的_id</p>
<blockquote>
<p> 如果插入文档时没有 “_ id” 键, 系统 会自动帮你创建一个。 可以由MongoDB 服务器来做这件事,但通常会在客户端由驱动程序完成。这一做法非常好地体现了 MongoDB 的哲学:能交给客户端驱动程序来做的事情就不要交给服务器来做。</p>
</blockquote>
</li>
<li><p>二进制数据</p>
</li>
<li><p>代码<br>查询和文档中可以包括任意 JavaScript 代码</p>
<pre><code>{&quot;x&quot; : function() { /* ... * / }}
</code></pre></li>
</ul>
<h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><pre><code>mongo some-host:30000/myDB
&lt;!-- 启动时不连接任何数据库 --&gt;
mongo --nodb
conn = new Mongo(&quot;some-host:30000&quot;)
db = conn.getDB(&quot;myDB&quot;)
</code></pre><ul>
<li><p>mongo 是一个简化的 JavaScript shell,可以通过查看 JavaScript 的在线文档得到大量帮助。对于 MongoDB 特有的功能,shell 内置了帮助文档,可以使用 help命令查看</p>
<pre><code>help
</code></pre></li>
<li><p>执行脚本</p>
<pre><code>&lt;!-- 命令行执行 --&gt;
mongo script1.js script2.js script3.js
&lt;!-- 交互执行 --&gt;
load(&quot;script1.js&quot;)
</code></pre></li>
<li><p>如果某些脚本会被频繁加载，可以将它们添加到 .mongorc.js 文件中。这个文件会在启动 shell 时自动运行。</p>
</li>
<li><p>.mongorc.js 最常见的用途之一是移除那些比较“危险”的 shell 辅助函数。可以在这里集中重写这些方法，比如为dropDatabase 或者 deleteIndexes 等辅助函数添加 no 选项，或者取消它们的定义。</p>
<pre><code>var no = function() {
    print(&quot;Not on my watch.&quot;);
};
// 禁止删除数据库
db.dropDatabase = DB.prototype.dropDatabase = no;
// 禁止删除集合
DBCollection.prototype.drop = no;
// 禁止删除索引
DBCollection.prototype.dropIndex = no;
</code></pre></li>
<li><p>在启动 shell 时指定 –norc 参数，就可以禁止加载 .mongorc.js。</p>
</li>
<li><p>定制shell提示</p>
<pre><code>prompt = function() {
    return (new Date())+&quot;&gt; &quot;;
};

prompt = function() {
    if (typeof db == &apos;undefined&apos;) {
        return &apos;(nodb)&gt; &apos;;
    }
    // 检查最后的数据库操作
    try {
        db.runCommand({getLastError:1});
    }
    catch (e) {
        print(e);
    }
    return db+&quot;&gt; &quot;;
};
</code></pre></li>
<li><p>配置编辑器</p>
<pre><code>EDITOR=&quot;/usr/bin/emacs&quot;
</code></pre></li>
<li><p>编辑变量</p>
<pre><code>var wap = db.books.findOne({title: &quot;War and Peace&quot;})
edit wap
</code></pre></li>
</ul>
<h3 id="客户端常用命令"><a href="#客户端常用命令" class="headerlink" title="客户端常用命令"></a>客户端常用命令</h3><ul>
<li><p>查看db当前指向的数据库</p>
<pre><code>&gt; db
test
</code></pre></li>
<li><p>切换数据库</p>
<pre><code>&gt; use foobar
switched to db foobar
</code></pre></li>
</ul>
<h2 id="创建、更新和删除文档"><a href="#创建、更新和删除文档" class="headerlink" title="创建、更新和删除文档"></a>创建、更新和删除文档</h2><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><pre><code>db.foo.insert({&quot;bar&quot; : &quot;baz&quot;})
&lt;!-- 批量插入 --&gt;
db.foo.batchInsert([{&quot;_ id&quot; : 0}, {&quot;_ id&quot; : 1}, {&quot;_ id&quot; : 2}])
&lt;!-- 忽略错误并且继续执行添加 continueOnError --&gt;
</code></pre><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><pre><code>db.foo.remove()
&lt;!-- 删除 mailing.list 集合中所有 &quot;opt-out&quot; 为true 的人 --&gt;
db.mailing.list.remove({&quot;opt-out&quot; : true})
&lt;!-- drop 直接删除集合会更快 --&gt;
db.tester.drop()
</code></pre><h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><ul>
<li><p>文档替换</p>
<pre><code>db.people.update({&quot;_ id&quot; : ObjectId(&quot;4b2b9f67a1f631733d917a7c&quot;)}, joe)
</code></pre></li>
<li><p>使用原子性的修改器，指定对文档中的某些字段进行更新。</p>
</li>
<li><p>要有人访问页面，就增加计数器。</p>
<pre><code>db.analytics.update({&quot;url&quot; : &quot;www.example.com&quot;}, {&quot;$inc&quot; : {&quot;pageviews&quot; : 1}})、
</code></pre></li>
<li><p>“$set” 用来指定一个字段的值。如果这个字段不存在，则创建它。</p>
</li>
<li><p>$unset 删除键</p>
<pre><code>db.users.update({&quot;name&quot; : &quot;joe&quot;}, {&quot;$unset&quot; : {&quot;favorite book&quot; : 1}})
</code></pre></li>
<li><p>增加、修改或删除键时，应该使用 $ 修改器。</p>
</li>
<li><p>“$inc” 修改器用来增加已有键的值，或者该键不存在那就创建一个。</p>
</li>
<li><p>“$push” 会向已有的数组末尾加入一个元素，要是没有就创建一个新的数组。</p>
</li>
<li><p>使用 “$each” 子操作符，可以通过一次 “$push” 操作添加多个值。</p>
</li>
<li><p>可以将 “$slice” 和 “$push” 组合在一起<br>使用，这样就可以保证数组不会超出设定好的最大长度</p>
</li>
<li><p>可以在清理元素之前使用 “$sort”，只要向数组中添加子对象就需要清理：</p>
<pre><code>db.movies.find({&quot;genre&quot; : &quot;horror&quot;},{&quot;$push&quot; : {&quot;top10&quot; : {&quot;$each&quot; : [{&quot;name&quot; : &quot;Nightmare on Elm Street&quot;, &quot;rating&quot; : 6.6},{&quot;name&quot; : &quot;Saw&quot;, &quot;rating&quot; : 4.3}],&quot;$slice&quot; : -10,&quot;$sort&quot; : {&quot;rating&quot; : -1}}}})
</code></pre></li>
<li><p>不能只将 “$slice” 或者 “$sort” 与 “$push” 配合使用，且必须使用 “$each”。</p>
</li>
<li><p>将数组作为set使用</p>
<pre><code>db.users.update({&quot;_ id&quot; : ObjectId(&quot;4b2d75476cc613d5ee930164&quot;)},{&quot;$addToSet&quot; : {&quot;emails&quot; : &quot;joe@gmail.com&quot;}})
</code></pre></li>
<li><p>{“$pop”:{“key”:1}} 从数组末尾删除一个元素，{“$pop”:{“key”:-1}} 则从头部删除。需要基于特定条件来删除元素，”$pull”。</p>
<pre><code>db.lists.update({}, {&quot;$pull&quot; : {&quot;todo&quot; : &quot;laundry&quot;}})
</code></pre></li>
<li><p>MongoDB 提供了定位操作符 “$”，用来定位查询文档已经匹配的数组元素，并进行更新。</p>
</li>
</ul>
<h3 id="upsert"><a href="#upsert" class="headerlink" title="upsert"></a>upsert</h3><ul>
<li><p>使用 upsert，既可以避免竞态问题，又可以缩减代码量（update 的第 3 个参数表示这是个 upsert）</p>
<pre><code>db.analytics.update({&quot;url&quot; : &quot;/blog&quot;}, {&quot;$inc&quot; : {&quot;pageviews&quot; : 1}}, true)
</code></pre></li>
<li><p>“$setOnInsert” 只会在文档插入时设置字段的值。</p>
</li>
<li><p>save 是一个 shell 函数，如果文档不存在，它会自动创建文档；如果文档存在，它就更新这个文档。</p>
</li>
<li><p>要更新所有匹配的文档，可以将 update 的第 4 个参数设置为 true。</p>
</li>
<li><p>运行 getLastError 命令（可以理<br>解为“返回最后一次操作的相关信息”）。键 “n” 的值就是被更新文档的数量。</p>
</li>
<li><p>调用 getLastError 仅能获得关于更新的有限信息，并不能返回被更新的文档。可以通过 findAndModify 命令得到被更新的文档。这对于操作队列以及执行其他需要进行原子性取值和赋值的操作来说，十分方便。</p>
</li>
</ul>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><ul>
<li><p>指定需要返回的键</p>
<pre><code>db.users.find({}, {&quot;username&quot; : 1, &quot;email&quot; : 1})
&lt;!-- 剔除 --&gt;
db.users.find({}, {&quot;fatal_weakness&quot; : 0})
</code></pre></li>
<li><p>“$lt”、”$lte”、”$gt” 和 “$gte” 就是全部的比较操作符，分别对应 &lt;、&lt;=、&gt; 和 &gt;=</p>
</li>
<li><p>“$ne”表示“不相等”</p>
<pre><code>db.users.find({&quot;username&quot; : {&quot;$ne&quot; : &quot;joe&quot;}})
</code></pre></li>
<li><p>or</p>
<pre><code>db.raffle.find({&quot;ticket_no&quot; : {&quot;$in&quot; : [725, 542, 390]}})
db.raffle.find({&quot;ticket_no&quot; : {&quot;$nin&quot; : [725, 542, 390]}})
db.raffle.find({&quot;$or&quot; : [{&quot;ticket_no&quot; : 725}, {&quot;winner&quot; : true}]})
</code></pre></li>
<li><p>not<br>“$mod” 会将查询的值除以第一个给定值，若余数等于第二个给定值则匹配成功</p>
<pre><code>db.users.find({&quot;id_num&quot; : {&quot;$mod&quot; : [5, 1]}})
db.users.find({&quot;id_num&quot; : {&quot;$not&quot; : {&quot;$mod&quot; : [5, 1]}}})
</code></pre></li>
<li><p>条件语句<br>注意，查询优化器不会对 “$and” 进行优化，这与其他操作符不同。</p>
<pre><code>db.users.find({&quot;$and&quot; : [{&quot;x&quot; : {&quot;$lt&quot; : 1}}, {&quot;x&quot; : 4}]})
</code></pre></li>
</ul>
<h2 id="mongoimport"><a href="#mongoimport" class="headerlink" title="mongoimport"></a>mongoimport</h2><p>支持JSON，CSV，TSV，CSV格式delimiter仅支持”,”和”\t”</p>
<ul>
<li>–fields 指定字段名字和类型</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/02/26/bigdata/hadoop_sqoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/bigdata/hadoop_sqoop/" itemprop="url">Sqoop</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-26T09:38:00+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/26/bigdata/hadoop_sqoop/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/26/bigdata/hadoop_sqoop/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MapReduce需要使用额外的API与存储在HDFS外的数据交互。例如，数据经常存储在RDBMS，开源的工具Sqoop允许用户将结构化数据提取到Hadoop，使用MapReduce处理或者更高级的工具(例如hive)。Sqoop可以将处理的最终结果导出到RDBMS。</p>
<h3 id="Getting-Sqoop"><a href="#Getting-Sqoop" class="headerlink" title="Getting Sqoop"></a>Getting Sqoop</h3><p>列出Sqoop所有的工具<br>    % sqoop help</p>
<p>列出具体工具的使用说明<br>    % sqoop help import</p>
<h3 id="Sqoop-Connectors"><a href="#Sqoop-Connectors" class="headerlink" title="Sqoop Connectors"></a>Sqoop Connectors</h3><p>Sqoop connector是一个模块化的组件，使得Sqoop可以将数据导入或导出到其它数据库(MySQL, PostgreSQL, Oracle, SQL Server, DB2, and Netezza)。如果数据库支持JDBC协议，可以使用通用的JDBC connector。Sqoop提供优化(MySQL, PostgreSQL, Oracle, and Netezza)后的connector，使用数据库定义的API，执行批量数据传输效率更高。</p>
<h3 id="A-Sample-Import"><a href="#A-Sample-Import" class="headerlink" title="A Sample Import"></a>A Sample Import</h3><p>我们先下载MySQL的JDBC driver JAR文件，放到Sqoop的lib目录下。<br>将数据表导入到HDFS<br>    % sqoop import –connect jdbc:mysql://localhost/mydatabase –table mytable -m 1<br>sqoop的导入工具将运行一个MapReduce工作，连接数据库并读表。默认开启4个map并行任务加快导入速度。每个任务导入到不同的文件，但是都在同一个目录下。(-m 1)指定单独的map任务。<br>检查导入的文件:<br>    % hadoop fs -cat widgets/part-m-00000<br>Sqoop默认导入逗号分割的文本文件，分割符可以明确指定，以及允许字段内容存在分割符的字段封闭符和转义符。</p>
<h3 id="Imports-A-Deeper-Look"><a href="#Imports-A-Deeper-Look" class="headerlink" title="Imports: A Deeper Look"></a>Imports: A Deeper Look</h3><p>分割数据到多个map任务可以提高导入性能，Sqoop通常会选择主键作为分割依据。<br>假设有100.000行数据，id为0-99.999，5个map分别执行查询：<br>    SELECT id, widget_name, … FROM widgets WHERE id &gt;= 0 AND id &lt; 20000 ,<br>    SELECT id, widget_name, … FROM widgets WHERE id &gt;= 20000 AND id &lt; 40000 ,<br>    and so on.<br>如果id非均匀分布，一些map会有很少甚至没有导入工作。用户可以指定字段作为分割依据(via the –split-by argument)。</p>
<h4 id="Controlling-the-Import"><a href="#Controlling-the-Import" class="headerlink" title="Controlling the Import"></a>Controlling the Import</h4><p>Sqoop不需要每次导入全部数据，可以导入表的子集，通过 –where 参数。<br>指定 –query参数，可以执行更多的控制。</p>
<h4 id="Incremental-Imports"><a href="#Incremental-Imports" class="headerlink" title="Incremental Imports"></a>Incremental Imports</h4><p>增量导入很常见，为了识别新数据，–check-column指定字段，–last-value指定值大于的数值。<br>这种方法适合新增而没有更新的情况，称为append模式。通过–incremental append激活。如果某一列记录最后更新时间，可以基于时间进行增量导入，通过–incremental lastmodified激活。<br>增量导入以后，Sqoop将打印出作为下次使用的last-value。手工导入时很有用，但是定期导入最好使用Sqoop的saved job工具，自动保存last value并用于下次job。sqoop job –hlep</p>
<h4 id="Direct-Mode-Imports"><a href="#Direct-Mode-Imports" class="headerlink" title="Direct-Mode Imports"></a>Direct-Mode Imports</h4><p>Sqoop有很多测律执行导入。有些数据库提供更快提取数据的工具，例如MySQL的mysqldump,这些工具的使用称为direct mode(via the –direct argument)。但是MySQL的direct mode不能处理大的对象，例如CLOB或者BLOB字段，所以Sqoop需要JDBC加载这些字段。因此direct mode不能像JDBC一样实现通用的目的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2019/01/31/bigdata/hadoop_guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/31/bigdata/hadoop_guide/" itemprop="url">hadoop2指南</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-31T11:30:00+08:00">
                2019-01-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BigData/" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/31/bigdata/hadoop_guide/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/31/bigdata/hadoop_guide/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Hadoop-Fundamentals"><a href="#Hadoop-Fundamentals" class="headerlink" title="Hadoop Fundamentals"></a>Hadoop Fundamentals</h2><h3 id="Chapter-1-Meet-Hadoop"><a href="#Chapter-1-Meet-Hadoop" class="headerlink" title="Chapter 1. Meet Hadoop"></a>Chapter 1. Meet Hadoop</h3><p>Hadoop通常指大型的生态系统，不仅仅是HDFS和MapReduce，属于分布式计算和大规模数据处理<br>例如，HBase，key-value存储方式，使用HDFS作为底层存储<br>yarn，Hadoop中新处理模型的推动者，它是一个集群资源管理系统，它允许分布式程序（不仅仅是MapReduce）在Hadoop集群处理数据<br>Hive，大数据集合低延迟的SQL交互查询<br>Spark，许多算法，例如机器学习算法，本质上是在数据集上的迭代计算，而MapReduce并不支持迭代数据持久化到内存，需要每次在磁盘载入，而Spark不需要<br>Solr，可在Hadoop集群上运行，索引文档存储在HDFS并提供查询服务<br>MapReduce有助于理解一些通用概念，例如输入格式概念和数据集的分片等<br>MapReduce等Hadoop处理模型都是随着数据量线性扩展的，而功能函数（例如Map和Reduce）可以在分区并行工作，因此假设据数量翻倍，而集群节点数量也翻倍，那么计算时间是不变的</p>
<h3 id="Chapter-2-MapReduce"><a href="#Chapter-2-MapReduce" class="headerlink" title="Chapter 2. MapReduce"></a>Chapter 2. MapReduce</h3><h4 id="A-Weather-Dataset"><a href="#A-Weather-Dataset" class="headerlink" title="A Weather Dataset"></a>A Weather Dataset</h4><p>我们以计算历年记录的最高温度为例，传统方法会逐行读取并比较获得最高温度。为了提高运行速度，可以使用并行处理。<br>1.我们可以使用不同的进程运行不同年份的记录，但是不同年份的数据量不同，计算时间取决于最大的文件。因此最好的办法是把输入的数据分割成大小相等的块再分别处理。<br>2.因为数据被分割成大小相等的块，每个数据块都会计算出不同年份的最大温度，最终我们还要找到每年的最大温度。<br>3.仍然会受限于单台计算机的处理能力，可以使用多台计算机，那么主要问题在与协调性和可靠性，哪台计算机执行全局的任务，如何处理失败的进程。<br>以上方法虽然可行但是繁杂，所以我们可以借助类似Hadoop的框架。</p>
<h4 id="Analyzing-the-Data-with-Hadoop"><a href="#Analyzing-the-Data-with-Hadoop" class="headerlink" title="Analyzing the Data with Hadoop"></a>Analyzing the Data with Hadoop</h4><p>MapReduce将操作分为两个阶段，map阶段和reduce阶段，每个阶段都是key-value对作为输入和输出，同时需要编写map和reduce方法。<br>map阶段的输入是NCDC原始的行数据，key是每行相对应文本开始位置的偏移值，不过可以忽略。map方法只是数据准备，只需要在每行数据中提取出年份和温度。<br>可视化map的工作<br>输入数据：<br>0067011990999991950051507004…9999999N9+00001+99999999999…<br>0043011990999991950051512004…9999999N9+00221+99999999999…<br>0043011990999991950051518004…9999999N9-00111+99999999999…<br>0043012650999991949032412004…0500001N9+01111+99999999999…<br>0043012650999991949032418004…0500001N9+00781+99999999999…<br>呈现给map方法的key-value对：<br>(0, 0067011990999991950051507004…9999999N9+00001+99999999999…)<br>(106, 0043011990999991950051512004…9999999N9+00221+99999999999…)<br>(212, 0043011990999991950051518004…9999999N9-00111+99999999999…)<br>(318, 0043012650999991949032412004…0500001N9+01111+99999999999…)<br>(424, 0043012650999991949032418004…0500001N9+00781+99999999999…)<br>map提取年份和温度，并输出：<br>(1950, 0)<br>(1950, 22)<br>(1950, -11)<br>(1949, 111)<br>(1949, 78)<br>MapReduce框架通过key聚合排序map的输出，再传输给reduce，所以reduce的输入为：<br>(1949, [111, 78])<br>(1950, [0, 22, −11])<br>reduce遍历list并找出最大温度：<br>(1949, 111)<br>(1950, 22)</p>
<h4 id="Scaling-Out"><a href="#Scaling-Out" class="headerlink" title="Scaling Out"></a>Scaling Out</h4><p>将数据储存在分布式文件系统，使用Hadoop的资源管理系统（YARN），可使得每台机器持有一部分数据进行MapReduce计算。</p>
<h5 id="Data-Flow"><a href="#Data-Flow" class="headerlink" title="Data Flow"></a>Data Flow</h5><p>YARN分配任务到集群节点，如果一个任务失败，会被自动分配到其它节点。Hadoop将输入数据分片并创建map任务将分片作为输入数据。<br>分片越小，负载均衡越好，因为一个运行速度快的机器可以处理更多的分片。<br>但是如果分片太小，分片的管理和map任务的创建会耗费太多的时间。分片大小最好等于HDFS的block，默认是128M。数据存在于执行map任务的节点，执行效率更高，因为节省了宝贵的集群间的带宽资源。<br>一个block大小的分片是可以保证存储在同一个节点的，这就是为什么最优分片大小是block size。假设分片大小是两个block size，执行map任务的节点可能没有恰好存储两个block，这就需要在节点间传输数据。<br>reduce任务数量可以自定义，map的输出需要通过网络传输合并传递给运行reduce的节点，reduce的输出通常存储在HDFS。<br>当有多个reduce时，map分割输出，相同的key必须在同一个分割，用户可以自定义分割，但是默认分割方法挺好的，</p>
<h5 id="Combiner-Functions"><a href="#Combiner-Functions" class="headerlink" title="Combiner Functions"></a>Combiner Functions</h5><p>许多MapReduce任务受限于集群的可用带宽，所以研究如何最小化map和reduce间传递的数据变得很重要。combiner方法允许用户指定并作用于map的输出，最后形成reduce的输入。因为combiner方法是优化方法，hadoop不保证可以运行几次combiner。<br>第一个map输出：<br>(1950, 0)<br>(1950, 20)<br>(1950, 10)<br>第二个输出：<br>(1950, 25)<br>(1950, 15)<br>reduce输入：<br>(1950, [0, 20, 10, 25, 15])<br>reduce输出：<br>(1950, 25)<br>我们可以使用combiner方法，类似于reduce，找到每个map输出的最大值：<br>(1950, [20, 25])<br>可表示为：<br>max(0, 20, 10, 25, 15) = max(max(0, 20, 10), max(25, 15)) = max(20, 25) = 25<br>但是，如果计算平均值，不能使用mean作为combiner，因为：<br>mean(0, 20, 10, 25, 15) = 14<br>但是：<br>mean(mean(0, 20, 10), mean(25, 15)) = mean(10, 20) = 15<br>综上，combiner可以减少传输数据的数量，值得考虑是否可以用combiner。</p>
<h3 id="Chapter-3-The-Hadoop-Distributed-Filesystem"><a href="#Chapter-3-The-Hadoop-Distributed-Filesystem" class="headerlink" title="Chapter 3. The Hadoop Distributed Filesystem"></a>Chapter 3. The Hadoop Distributed Filesystem</h3><h4 id="The-Design-of-HDFS"><a href="#The-Design-of-HDFS" class="headerlink" title="The Design of HDFS"></a>The Design of HDFS</h4><p>HDFS is a filesystem designed for storing very large files with streaming data access<br>patterns, running on clusters of commodity hardware.</p>
<p>Very large files<br>文件大小数百M，G，T，P</p>
<p>Streaming data access<br>HDFS建立在最有效的数据处理模式下，一次写入，多次读取的模式。因此读取整个数据集的时间比读取第一条数据的延迟时间更重要。</p>
<p>Commodity hardware<br>Hadoop不需要昂贵，高可靠性的硬件。</p>
<p>Low-latency data access<br>HDFS对几十毫秒内的低延迟访问表现不好，因为它主要优化方向是高吞吐量，势必造成高延迟。HBase是当前达到低延迟的选择。</p>
<p>Lots of small files<br>namenode将文件系统元数据放在内存，而每个文件，目录，block占用大约150比特。假设有100万的文件，每个文件是一个block，需要300M内存。</p>
<p>Multiple writers, arbitrary file modifications<br>目前仅支持单用户在文件末尾append</p>
<h4 id="HDFS-Concepts"><a href="#HDFS-Concepts" class="headerlink" title="HDFS Concepts"></a>HDFS Concepts</h4><h5 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h5><p>每个block默认128M，文件被拆分成block大小，不足block大小的文件虽然是一个block，但是仅占用实际大小的空间。<br>block带给分布式系统好处：</p>
<ol>
<li>文件大小可以大于单个结点的磁盘</li>
<li>简化储存子系统</li>
<li>适合复制，增加了系统容错能力，默认复制到3个结点</li>
</ol>
<h5 id="Namenodes-and-Datanodes"><a href="#Namenodes-and-Datanodes" class="headerlink" title="Namenodes and Datanodes"></a>Namenodes and Datanodes</h5><p>HDFS集群是master−worke模式，一个namenode（master）和一些datanode（workers）。namenode管理文件系统命名空间。它包含文件系统树和所有文件及目录的元数据，这些数据持久化在本地磁盘，两个文件分别是namespace image和edit log。namenode不持久化block的位置，因为每次系统启动都会通过datanode重建位置信息。<br>客户端访问namenode和datanode，对用户来说是透明的。<br>datanode存储检索block并周期性的向namenode报告blocks的存储情况。<br>没有namenode，HDFS将无法工作。namenode故障将使得文件系统的文件丢失，为了避免这种情况，Hadoop提供了两种机制：<br>第一种是备份文件系统元数据，备份是同步的和原子的，通常的配置是写入本地磁盘和原称NFS mount。<br>第二种是运行secondary namenode，周期性的合并namespace image及edit log。secondary namenode常运行在单独的机器，因为它需要大量的CPU和内存执行merge。如果主namenode挂了，总会出现数据丢失，在这种情况通常从NFS复制一份namenode的元数据到ssecondary namenode并将其作为namenode使用。</p>
<h5 id="Block-Caching"><a href="#Block-Caching" class="headerlink" title="Block Caching"></a>Block Caching</h5><p>通常datanode从disk读block，但是对高频访问的block可以明确缓存到datanode的内存，可以增加读的效率。应用通过添加缓存指令到缓存池来指导namenode缓存文件。</p>
<h5 id="HDFS-Federation"><a href="#HDFS-Federation" class="headerlink" title="HDFS Federation"></a>HDFS Federation</h5><p>每个文件和块的引用是保存在namenode的内存中的，我们可以添加namenode去扩展，每个namenode管理一部分的namespace，相互对立，不影响其它namenode的可用性</p>
<h5 id="HDFS-High-Availability"><a href="#HDFS-High-Availability" class="headerlink" title="HDFS High Availability"></a>HDFS High Availability</h5><p>secondary namenode元数据并使用辅助namenode防止数据丢失，不能获得高可用的系统。<br>如果namenode挂掉，新的namenode需要载入namespace image到内存，重现edit log，接收所有datanode上报的block映射关系，才能正常运行。在大型集群，需要耗费30分钟甚至更长的时间。<br>Hadoop 2添加高可用性（HA）支持，使用一对namenode（active-standby），active namenode挂掉，standby可以很快提供服务。<br>架构需要做一些改动：</p>
<ul>
<li>namenode必须使用高可用性共享存储来共享编辑日志</li>
<li>datanode必须向所以namenode发送block的映射信息</li>
<li>客户端需要配置处理故障转移，对用户透明</li>
</ul>
<h4 id="The-Command-Line-Interface"><a href="#The-Command-Line-Interface" class="headerlink" title="The Command-Line Interface"></a>The Command-Line Interface</h4><p>首先安装一个伪分布式的Hadoop，配置文件中的fs.defaultFS设置为hdfs://localhost/，使用HDFS作为Hadoop的文件系统。<br>dfs.replication设置为1（默认3），不对blocks进行复制。<br>获得帮助信息</p>
<pre><code>hadoop fs -help 
</code></pre><p>从本地文件系统复制文件到HDFS</p>
<pre><code>% hadoop fs -copyFromLocal input/docs/quangle.txt \
hdfs://localhost/user/tom/quangle.txt
</code></pre><p>我们可以省略schema和host，使用定义在core-site.xml中的值</p>
<pre><code>% hadoop fs -copyFromLocal input/docs/quangle.txt /user/tom/quangle.txt
</code></pre><p>创建文件夹以及列出所有的文件</p>
<pre><code>% hadoop fs -mkdir books
% hadoop fs -ls .
</code></pre><h4 id="Hadoop-Filesystems"><a href="#Hadoop-Filesystems" class="headerlink" title="Hadoop Filesystems"></a>Hadoop Filesystems</h4><p>Hadoop有许多种Filesystems</p>
<h5 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h5><p>接口有Java的Native API<br>有HTTP REST API，通过HTTP访问HDFS有两种方式：<br>1、直接访问namenode，然后重定向到datanode<br>2、使用代理服务器，代理负责访问namenode和重定向到datanode，这中方式可以允许更严格的防火墙和带宽限制策略<br>HTTP接口速度比Native慢</p>
<h4 id="Parallel-Copying-with-distcp"><a href="#Parallel-Copying-with-distcp" class="headerlink" title="Parallel Copying with distcp"></a>Parallel Copying with distcp</h4><p>并行复制数据，可以有效代替 hadoop fs -cp<br>复制一个文件</p>
<pre><code>% hadoop distcp file1 file2
</code></pre><p>复制目录</p>
<pre><code>% hadoop distcp dir1 dir2
</code></pre><p>如果dir2不存在，则新建dir2并且把dir1的数据拷贝到dir2。如果dir2存在,则dir1会复制到dir2/dir1。<br>使用 -overwrite 选项可以避免改变目录结构。<br>使用 -update 选项只同步更新。</p>
<pre><code>% hadoop distcp -update dir1 dir2
</code></pre><p>distcp使用MapReduce任务实现，并行的maps执行复制，没有reduce。多达20个maps执行复制，可以通过 -m 参数指定数量。<br>distcp通常用于两个集群间传递数据</p>
<pre><code>% hadoop distcp -update -delete -p hdfs://namenode1/foo hdfs://namenode2/foo
</code></pre><p>–delete 删除namenode1不存在的文件，-p 保存文件参数，例如，block大小、权限等。<br>如果两个集群HDFS版本不同，可以使用webhdfs协议</p>
<pre><code>% hadoop distcp webhdfs://namenode1:50070/foo webhdfs://namenode2:50070/foo
</code></pre><h5 id="Keeping-an-HDFS-Cluster-Balanced"><a href="#Keeping-an-HDFS-Cluster-Balanced" class="headerlink" title="Keeping an HDFS Cluster Balanced"></a>Keeping an HDFS Cluster Balanced</h5><p>为保证集群中每个结点的blocks数量平衡，建议使用默认的20个map执行distcp，因为如果只有一个map，那么所有复制的block都会在运行map的node建立一个副本。</p>
<h3 id="Chapter-4-YARN"><a href="#Chapter-4-YARN" class="headerlink" title="Chapter 4. YARN"></a>Chapter 4. YARN</h3><p>YARN是在Hadoop2引入的，改善MapReduce的实现，并且支持其他分布式计算框架。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jokers" />
          <p class="site-author-name" itemprop="name">Jokers</p>
           
              <p class="site-description motion-element" itemprop="description">hlxstc680@gmail.com</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">44</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jokers</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://thathub-com.disqus.com.disqus.com/count.js" async></script>
    

    

  




	





  








  





  

  

  

  

  

  

</body>
</html>
