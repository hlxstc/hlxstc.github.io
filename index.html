<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="hlxstc680@gmail.com">
<meta property="og:type" content="website">
<meta property="og:title" content="Jokers&#39;s Blog">
<meta property="og:url" content="http://thathub.com/index.html">
<meta property="og:site_name" content="Jokers&#39;s Blog">
<meta property="og:description" content="hlxstc680@gmail.com">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jokers&#39;s Blog">
<meta name="twitter:description" content="hlxstc680@gmail.com">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://thathub.com/"/>





  <title>Jokers's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jokers's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">高尚是高尚者的墓志铭 卑鄙是卑鄙者的通行证</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/09/20/ngrok/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/20/ngrok/" itemprop="url">ngrok</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-20T14:28:00+08:00">
                2018-09-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/20/ngrok/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/20/ngrok/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>The plan is to create a pair of executables (ngrok and ngrokd) that are connected with a self-signed SSL cert. Since the client and server executables are paired, you won’t be able to use any other ngrok to connect to this ngrokd, and vice versa.</p>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>Add two DNS records: one for the base domain and one for the wildcard domain. For example, if your base domain is domain.com, you’ll need a record for that and for *.domain.com.</p>
<h3 id="Different-Operating-Systems"><a href="#Different-Operating-Systems" class="headerlink" title="Different Operating Systems"></a>Different Operating Systems</h3><p>If the OS on which you’ll be compiling ngrok (that’s the server section below) is different than the OS on which you’ll be running the client, then you will need to set the GOOS and GOARCH env variables. I run Linux everywhere, so I don’t know how to do that. Please Google it or see the discussion here. If you know how to do this and want to add GOOS/GOARCH instructions here, please let me know.</p>
<h3 id="On-Server"><a href="#On-Server" class="headerlink" title="On Server"></a>On Server</h3><p>MAKE SURE YOU SET NGROK_DOMAIN BELOW. Set it to the base domain, not the wildcard domain.</p>
<pre><code>NGROK_DOMAIN=&quot;my.domain.com&quot;
git clone https://github.com/inconshreveable/ngrok.git
cd ngrok

openssl genrsa -out rootCA.key 2048
openssl req -x509 -new -nodes -key rootCA.key -subj &quot;/CN=$NGROK_DOMAIN&quot; -days 5000 -out rootCA.pem
openssl genrsa -out device.key 2048
openssl req -new -key device.key -subj &quot;/CN=$NGROK_DOMAIN&quot; -out device.csr
openssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000

cp rootCA.pem assets/client/tls/ngrokroot.crt
# make clean
make release-server release-client
</code></pre><p>Copy bin/ngrok to whatever computer you want to connect from. Then start the server:</p>
<pre><code>bin/ngrokd -tlsKey=device.key -tlsCrt=device.crt -domain=&quot;$NGROK_DOMAIN&quot; -httpAddr=&quot;:8000&quot; -httpsAddr=&quot;:8001&quot;
</code></pre><h3 id="On-Client"><a href="#On-Client" class="headerlink" title="On Client"></a>On Client</h3><p>MAKE SURE YOU SET NGROK_DOMAIN BELOW. Set it to the base domain, not the wildcard domain.</p>
<pre><code>NGROK_DOMAIN=&quot;my.domain.com&quot;
echo -e &quot;server_addr: $NGROK_DOMAIN:4443\ntrust_host_root_certs: false&quot; &gt; ngrok-config
./ngrok -config=ngrok-config 80
</code></pre><p>Or for SSH forwarding: ./ngrok -config=ngrok-config –proto=tcp 22</p>
<h3 id="Define-a-fixed-TCP-listen-port"><a href="#Define-a-fixed-TCP-listen-port" class="headerlink" title="Define a fixed TCP listen port"></a>Define a fixed TCP listen port</h3><p>Set port number to the remote_port args. Be sure to pay attention to the format</p>
<pre><code>tunnels:
  mysql:
    proto:
      tcp:3306
    remote_port: 36799
</code></pre><h3 id="Run-ngrok-client-with-config"><a href="#Run-ngrok-client-with-config" class="headerlink" title="Run ngrok client with -config"></a>Run ngrok client with -config</h3><p>Create an ngrok configuration file, “debug.yml” with the following contents:</p>
<pre><code>server_addr: ngrok.domain.com:4443
trust_host_root_certs: false
tunnels:
  ssh:
    proto:
      http: 22
    subdomain: 22
  mysql:
    proto:
      tcp: 3306
    remote_port: 36799
</code></pre><p>Then run ngrok</p>
<pre><code>./bin/ngrok -config=debug.yml -log=stdout start-all
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/09/10/chrome_install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/10/chrome_install/" itemprop="url">Linux 安装 Chrome</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-10T11:55:00+08:00">
                2018-09-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/10/chrome_install/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/10/chrome_install/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="添加仓库来源"><a href="#添加仓库来源" class="headerlink" title="添加仓库来源"></a>添加仓库来源</h2><ul>
<li><p>在  /etc/yum.repos.d/ 目录新建 repo file</p>
<pre><code>vi /etc/yum.repos.d/google-chrome.repo
</code></pre></li>
<li><p>复制以下仓库信息</p>
<pre><code>[google-chrome]
name=google-chrome
baseurl=http://dl.google.com/linux/chrome/rpm/stable/x86_64
enabled=1
gpgcheck=1
gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub
</code></pre></li>
<li><p>没有翻墙代理无法访问gpgkey怎么办</p>
<pre><code># 找一台能翻墙的电脑下载 linux_signing_key.pub
gpgkey=file:///dir/linux_signing_key.pub
</code></pre></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code>yum install -y google-chrome-stable
or
yum install -y google-chrome-beta
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/08/28/flask/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/28/flask/" itemprop="url">Flask使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-28T10:00:58+08:00">
                2018-08-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/28/flask/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/28/flask/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>所有Web框架的使用都有自己的套路，作为一个框架本质就是一个工具。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code>pip install Flask
</code></pre><h3 id="自动安装的依赖"><a href="#自动安装的依赖" class="headerlink" title="自动安装的依赖"></a>自动安装的依赖</h3><ul>
<li><a href="http://werkzeug.pocoo.org/" target="_blank" rel="noopener">Werkzeug</a> 应用及服务间的标准接口</li>
<li><a href="http://jinja.pocoo.org/" target="_blank" rel="noopener">Jinja</a> 模板</li>
<li><a href="https://pypi.org/project/MarkupSafe/" target="_blank" rel="noopener">MarkupSafe</a> Jinja附带，防止注入攻击</li>
<li><a href="https://pythonhosted.org/itsdangerous/" target="_blank" rel="noopener">ItsDangerous</a> 数据完整性，保护 session cookie 安全</li>
<li><a href="http://click.pocoo.org/5/" target="_blank" rel="noopener">Click</a> 命令行应用框架</li>
</ul>
<h3 id="可选安装的依赖"><a href="#可选安装的依赖" class="headerlink" title="可选安装的依赖"></a>可选安装的依赖</h3><ul>
<li><a href="https://pythonhosted.org/blinker/" target="_blank" rel="noopener">Blinker</a> provides support for <a href="http://flask.pocoo.org/docs/1.0/signals/#signals" target="_blank" rel="noopener">Signals</a></li>
<li><a href="https://simplejson.readthedocs.io/en/latest/" target="_blank" rel="noopener">SimpleJSON</a> fast JSON</li>
<li><a href="https://github.com/theskumar/python-dotenv#readme" target="_blank" rel="noopener">python-dotenv</a></li>
<li><a href="https://pythonhosted.org/watchdog/" target="_blank" rel="noopener">Watchdog</a></li>
</ul>
<h2 id="Virtual-environments"><a href="#Virtual-environments" class="headerlink" title="Virtual environments"></a>Virtual environments</h2><ul>
<li>创建<br>  $ mkdir myproject<br>  $ cd myproject<br>  $ python3 -m venv venv</li>
<li>激活<br>  $ . venv/bin/activate</li>
</ul>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><pre><code>from flask import Flask
app = Flask(__name__)

@app.route(&apos;/&apos;)
def hello_world():
return &apos;Hello, World!&apos;
</code></pre><ul>
<li>运行，设置环境变量 FLASK_APP<pre><code>$ FLASK_APP=hello.py flask run
</code></pre></li>
<li>监听公共 IP ，确保 debugger 模式已关<pre><code>flask run --host=0.0.0.0
</code></pre></li>
</ul>
<h2 id="Debug-Mode"><a href="#Debug-Mode" class="headerlink" title="Debug Mode"></a>Debug Mode</h2><pre><code>export FLASK_ENV=development
or FLASK_APP=hello.py FLASK_ENV=development flask run
</code></pre><h2 id="Variable-Rules"><a href="#Variable-Rules" class="headerlink" title="Variable Rules"></a>Variable Rules</h2><pre><code>@app.route(&apos;/user/&lt;username&gt;&apos;)
def show_user_profile(username):
    # show the user profile for that user
    return &apos;User %s&apos; % username

@app.route(&apos;/post/&lt;int:post_id&gt;&apos;)
def show_post(post_id):
    # show the post with the given id, the id is an integer
    return &apos;Post %d&apos; % post_id

@app.route(&apos;/path/&lt;path:subpath&gt;&apos;)
def show_subpath(subpath):
    # show the subpath after /path/
    return &apos;Subpath %s&apos; % subpath
</code></pre><h2 id="URL-结尾斜线"><a href="#URL-结尾斜线" class="headerlink" title="URL 结尾斜线"></a>URL 结尾斜线</h2><ul>
<li>不带斜线访问，会 redirects 到带斜线的 URL<pre><code>@app.route(&apos;/projects/&apos;)
def projects():
    return &apos;The project page&apos;
</code></pre></li>
<li>带斜线访问，会返回404，避免搜索引擎索引同一个页面两次<pre><code>@app.route(&apos;/about&apos;)
def about():
    return &apos;The about page&apos;
</code></pre></li>
</ul>
<h2 id="HTTP-Methods"><a href="#HTTP-Methods" class="headerlink" title="HTTP Methods"></a>HTTP Methods</h2><pre><code>from flask import request

@app.route(&apos;/login&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])
def login():
if request.method == &apos;POST&apos;:
    return do_the_login()
else:
    return show_the_login_form()
</code></pre><h2 id="URL-构建"><a href="#URL-构建" class="headerlink" title="URL 构建"></a>URL 构建</h2><pre><code>from flask import Flask, url_for

app = Flask(__name__)

@app.route(&apos;/&apos;)
def index():
    return &apos;index&apos;

@app.route(&apos;/login&apos;)
def login():
    return &apos;login&apos;

@app.route(&apos;/user/&lt;username&gt;&apos;)
def profile(username):
    return &apos;{}\&apos;s profile&apos;.format(username)

with app.test_request_context():
    print(url_for(&apos;index&apos;))
    print(url_for(&apos;login&apos;))
    print(url_for(&apos;login&apos;, next=&apos;/&apos;))
    print(url_for(&apos;profile&apos;, username=&apos;John Doe&apos;))

/
/login
/login?next=/
/user/John%20Doe
</code></pre><h2 id="Static-Files"><a href="#Static-Files" class="headerlink" title="Static Files"></a>Static Files</h2><p>在项目下创建 static 目录，存放 static files ,对于 url_for ，static 是保留字，用于生成指向 static 目录下的 URL</p>
<pre><code>url_for(&apos;static&apos;, filename=&apos;style.css&apos;)
</code></pre><h2 id="Rendering-Templates"><a href="#Rendering-Templates" class="headerlink" title="Rendering Templates"></a>Rendering Templates</h2><p>Flask 自动配置<a href="http://jinja.pocoo.org/docs/2.10/templates/" target="_blank" rel="noopener">Jinja2</a> template engine. Flask 自动去 templates 目录查找 template</p>
<pre><code>from flask import render_template

@app.route(&apos;/hello/&apos;)
@app.route(&apos;/hello/&lt;name&gt;&apos;)
def hello(name=None):
    return render_template(&apos;hello.html&apos;, name=name)
</code></pre><h2 id="The-Request-Object"><a href="#The-Request-Object" class="headerlink" title="The Request Object"></a>The Request Object</h2><pre><code>from flask import request

@app.route(&apos;/login&apos;, methods=[&apos;POST&apos;, &apos;GET&apos;])
def login():
    error = None
    if request.method == &apos;POST&apos;:
        if valid_login(request.form[&apos;username&apos;],
                       request.form[&apos;password&apos;]):
            return log_the_user_in(request.form[&apos;username&apos;])
        else:
            error = &apos;Invalid username/password&apos;
    # the code below is executed if the request method
    # was GET or the credentials were invalid
    return render_template(&apos;login.html&apos;, error=error)
</code></pre><ul>
<li>获取 form data, 使用 form 属性</li>
<li>获取 parameters submitted in the URL (?key=value), request.args.get(‘key’, ‘’)</li>
</ul>
<h2 id="File-Uploads"><a href="#File-Uploads" class="headerlink" title="File Uploads"></a>File Uploads</h2><p>enctype=”multipart/form-data”</p>
<pre><code>from flask import request

@app.route(&apos;/upload&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])
def upload_file():
if request.method == &apos;POST&apos;:
    f = request.files[&apos;the_file&apos;]
    f.save(&apos;/var/www/uploads/uploaded_file.txt&apos;)
...
</code></pre><ul>
<li><p>使用客户端的文件名存储在服务端，可以使用 secure_filename() 获取文件名</p>
<pre><code>from flask import request
from werkzeug.utils import secure_filename

@app.route(&apos;/upload&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])
    def upload_file():
    if request.method == &apos;POST&apos;:
    f = request.files[&apos;the_file&apos;]
    f.save(&apos;/var/www/uploads/&apos; + secure_filename(f.filename))
</code></pre></li>
</ul>
<h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><ul>
<li><p>读</p>
<pre><code>from flask import request

@app.route(&apos;/&apos;)
def index():
    username = request.cookies.get(&apos;username&apos;)
    # use cookies.get(key) instead of cookies[key] to not get a
    # KeyError if the cookie is missing.
</code></pre></li>
<li><p>写</p>
<p>  from flask import make_response</p>
<p>  @app.route(‘/‘)<br>  def index():</p>
<pre><code>resp = make_response(render_template(...))
resp.set_cookie(&apos;username&apos;, &apos;the username&apos;)
return resp
</code></pre></li>
<li><p>通常 Flask 自动转换返回值为 response objects ，如果自己想明确的指定 response 需要使用  make_response()</p>
</li>
</ul>
<h2 id="redirect-abort"><a href="#redirect-abort" class="headerlink" title="redirect() abort()"></a>redirect() abort()</h2><pre><code>from flask import abort, redirect, url_for

@app.route(&apos;/&apos;)
def index():
    return redirect(url_for(&apos;login&apos;))

@app.route(&apos;/login&apos;)
def login():
    abort(401)
    this_is_never_executed()
</code></pre><ul>
<li><p>使用 errorhandler() decorator 自定义 error page</p>
<pre><code>from flask import render_template

@app.errorhandler(404)
def page_not_found(error):
    return render_template(&apos;page_not_found.html&apos;), 404
</code></pre></li>
</ul>
<h2 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h2><ul>
<li><p>set a secret key</p>
<pre><code>from flask import Flask, session, redirect, url_for, escape, request

app = Flask(__name__)

# Set the secret key to some random bytes. Keep this really secret!
app.secret_key = b&apos;\_5#y2L&quot;F4Q8z\n\xec]/&apos;

@app.route(&apos;/&apos;)
def index():
    if &apos;username&apos; in session:
        return &apos;Logged in as %s&apos; % escape(session[&apos;username&apos;])
    return &apos;You are not logged in&apos;

@app.route(&apos;/login&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])
def login():
    if request.method == &apos;POST&apos;:
        session[&apos;username&apos;] = request.form[&apos;username&apos;]
        return redirect(url_for(&apos;index&apos;))
    return &apos;&apos;&apos;
        &lt;form method=&quot;post&quot;&gt;
            &lt;p&gt;&lt;input type=text name=username&gt;
            &lt;p&gt;&lt;input type=submit value=Login&gt;
        &lt;/form&gt;
    &apos;&apos;&apos;

@app.route(&apos;/logout&apos;)
def logout():
    # remove the username from the session if it&apos;s there
    session.pop(&apos;username&apos;, None)
    return redirect(url_for(&apos;index&apos;))
</code></pre></li>
<li><p>escape(), 如果不使用模板引擎，escape 可转换 html 特殊字符</p>
</li>
<li>generate good secret keys, os.urandom(16)</li>
</ul>
<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><pre><code>app.logger.debug(&apos;A value for debugging&apos;)
app.logger.warning(&apos;A warning occurred (%d apples)&apos;, 42)
app.logger.error(&apos;An error occurred&apos;)
</code></pre><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ul>
<li>Flask 自带 wsgi 扩展性能不好，仅适用于开发环境</li>
<li>WSGI HTTP Server 可选的有 Gunicorn 和 uWSGI</li>
<li>Nginx 作为静态文件访问容器和反向代理、分布式环境下作负载均衡</li>
</ul>
<h3 id="Gunicorn"><a href="#Gunicorn" class="headerlink" title="Gunicorn"></a>Gunicorn</h3><ul>
<li><p>安装</p>
<pre><code>$ pip install gunicorn
</code></pre></li>
<li><p>Async Workers<br>Gunicorn 默认同步 Workers ，通常我们还需要安装 Eventlet 或则 Gevent ，实现异步 Workers 。greenlet 是默认安装的。eventlet 和 gevent 性能差不多，可以选一个安装。</p>
<pre><code>$ pip install greenlet            # Required for both
$ pip install eventlet            # For eventlet workers
$ pip install gunicorn[eventlet]  # Or, using extra
$ pip install gevent              # For gevent workers
$ pip install gunicorn[gevent]    # Or, using extra
</code></pre></li>
<li><p>运行</p>
<pre><code>gunicorn --workers=2 --worker-class=eventlet hello:app
</code></pre></li>
<li><p>其它参数</p>
<pre><code>-c CONFIG, --config=CONFIG  Specify a config file in the form $(PATH), file:$(PATH), or python:$(MODULE_NAME).
-b BIND, --bind=BIND - Specify a server socket to bind. Server sockets can be any of $(HOST), $(HOST):$(PORT), or unix:$(PATH). An IP is a valid $(HOST).
-n APP_NAME, --name=APP_NAME - If setproctitle is installed you can adjust the name of Gunicorn process as they appear in the process system table (which affects tools like ps and top).
</code></pre></li>
</ul>
<h3 id="布署-Gunicorn"><a href="#布署-Gunicorn" class="headerlink" title="布署 Gunicorn"></a><a href="http://docs.gunicorn.org/en/stable/deploy.html" target="_blank" rel="noopener">布署 Gunicorn</a></h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/08/15/reverse_proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/15/reverse_proxy/" itemprop="url">Nginx作反向代理保护Kibana</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-15T17:36:00+08:00">
                2018-08-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/15/reverse_proxy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/15/reverse_proxy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="安装-Nginx-，先安装-EPEL-repository"><a href="#安装-Nginx-，先安装-EPEL-repository" class="headerlink" title="安装 Nginx ，先安装 EPEL repository"></a>安装 Nginx ，先安装 EPEL repository</h3><pre><code>$ yum install epel-release
$ yum install nginx
$ systemctl start nginx
$ systemctl enable nginx
</code></pre><h3 id="httpd-tools-setting-up-an-HTTP-authentication"><a href="#httpd-tools-setting-up-an-HTTP-authentication" class="headerlink" title="httpd-tools, setting up an HTTP authentication"></a>httpd-tools, setting up an HTTP authentication</h3><pre><code>$ yum install httpd-tools
</code></pre><ul>
<li><p>create a “.htpasswd” file to store our credential data such as Usernames and Passwords in an encrypted format</p>
<pre><code>$ htpasswd -c [filename] /etc/nginx/ username
</code></pre></li>
</ul>
<h3 id="Configuring-Nginx"><a href="#Configuring-Nginx" class="headerlink" title="Configuring Nginx"></a>Configuring Nginx</h3><pre><code>$ /etc/nginx/nginx.conf
</code></pre><ul>
<li><p>Find the “server” directive and change it  like below:</p>
<pre><code>server {
    listen *:80;
    server_name _;
    location / {
        proxy_pass http://localhost:5601;
        auth_basic &quot;Restricted&quot;;
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}
</code></pre></li>
<li><p>检查 Nginx 配置</p>
<pre><code>$ nginx -t
</code></pre></li>
<li><p>重启 Nginx</p>
<pre><code>$ systemctl restart nginx
</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/08/14/elastcsearch-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/14/elastcsearch-command/" itemprop="url">Elasticsearch常用操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-14T15:36:00+08:00">
                2018-08-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/14/elastcsearch-command/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/14/elastcsearch-command/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Reindex"><a href="#Reindex" class="headerlink" title="Reindex"></a>Reindex</h2><ol>
<li>新建一个 index ，复制原 index 的 mappings 和 settings</li>
<li><p>设置新 index 的 refresh_interval 为-1， number_of_replicas 为 0， reindex 效率更高</p>
<pre><code>PUT /twitter/_settings
{
    &quot;index&quot; : {
        &quot;number_of_replicas&quot; : 0
    }
}

PUT /twitter/_settings
{
    &quot;index&quot; : {
        &quot;refresh_interval&quot; : &quot;-1&quot;
    }
}
</code></pre></li>
<li><p>reindex api</p>
<ul>
<li><p>Just leaving out version_type (as above) or setting it to internal will cause Elasticsearch to blindly dump documents into the target, overwriting any that happen to have the same type and id:</p>
<pre><code>POST _reindex
{
    &quot;source&quot;: {
        &quot;index&quot;: &quot;twitter&quot;
    },
    &quot;dest&quot;: {
        &quot;index&quot;: &quot;new_twitter&quot;,
        &quot;version_type&quot;: &quot;internal&quot;
    }
}
</code></pre></li>
<li><p>Setting version_type to external will cause Elasticsearch to preserve the version from the source, create any documents that are missing, and update any documents that have an older version in the destination index than they do in the source index</p>
<pre><code>POST _reindex
{
    &quot;source&quot;: {
        &quot;index&quot;: &quot;twitter&quot;
    },
    &quot;dest&quot;: {
        &quot;index&quot;: &quot;new_twitter&quot;,
        &quot;version_type&quot;: &quot;external&quot;
    }
}
</code></pre></li>
<li><p>Settings op_type to create will cause _reindex to only create missing documents in the target index. All existing documents will cause a version conflic</p>
<pre><code>POST _reindex
{
    &quot;source&quot;: {
        &quot;index&quot;: &quot;twitter&quot;
    },
    &quot;dest&quot;: {
        &quot;index&quot;: &quot;new_twitter&quot;,
        &quot;op_type&quot;: &quot;create&quot;
    }
}
</code></pre></li>
<li><p>By default version conflicts abort the _reindex process but you can just count them by settings “conflicts”: “proceed” in the request body</p>
<pre><code>POST _reindex
{
    &quot;conflicts&quot;: &quot;proceed&quot;,
    &quot;source&quot;: {
        &quot;index&quot;: &quot;twitter&quot;
    },
    &quot;dest&quot;: {
        &quot;index&quot;: &quot;new_twitter&quot;,
        &quot;op_type&quot;: &quot;create&quot;
    }
}
</code></pre></li>
<li><p>如果某个字段设置了 completion suggest ,重建索引时或则索引数据时因相应字段为空会报错</p>
<pre><code># value must have a length &gt; 0
# elasticsearch completion field does not support null values

POST _reindex
{
    &quot;source&quot;: {
        &quot;index&quot;: &quot;twitter&quot;
    },
    &quot;dest&quot;: {
        &quot;index&quot;: &quot;new_twitter&quot;
    }
}
&quot;script&quot;: {
    &quot;source&quot;: &quot;if (ctx._source.name == null || ctx._source.name == &apos;&apos;) {ctx._source.tmname=&apos; &apos;}&quot;,
    &quot;lang&quot;: &quot;painless&quot;
}
</code></pre></li>
<li><p>kibana 30s 后返回 timeout ，在请求后跟参数 ?wait_for_completion=true</p>
</li>
</ul>
</li>
<li><p>重新设置 refresh_interval 和 number_of_replicas</p>
</li>
<li>等待 index 状态 变为 green</li>
<li>添加 aliases</li>
</ol>
<h2 id="Reindex-task"><a href="#Reindex-task" class="headerlink" title="Reindex task"></a>Reindex task</h2><ul>
<li><p>获取正在运行的 reindex</p>
<pre><code>GET _tasks?detailed=true&amp;actions=*reindex
</code></pre></li>
<li><p>查看单个 task</p>
<pre><code>GET /_tasks/taskId:1
</code></pre></li>
<li><p>删除某个 task</p>
<pre><code>POST _tasks/task_id:1/_cancel
</code></pre></li>
</ul>
<h2 id="null-value"><a href="#null-value" class="headerlink" title="null_value"></a>null_value</h2><p>null 值不能被索引和查询， null_value 可以明确的替换 null 值</p>
<pre><code>PUT my_index
{
    &quot;mappings&quot;: {
        &quot;_doc&quot;: {
          &quot;properties&quot;: {
            &quot;status_code&quot;: {
              &quot;type&quot;:       &quot;keyword&quot;,
              &quot;null_value&quot;: &quot;NULL&quot;
            }
          }
        }
    }
}
</code></pre><ul>
<li>The null_value needs to be the same datatype as the field. For instance, a long field cannot have a string null_value.</li>
<li>The null_value only influences how data is indexed, it doesn’t modify the _source document.</li>
</ul>
<h2 id="Completion-Suggester"><a href="#Completion-Suggester" class="headerlink" title="Completion Suggester"></a>Completion Suggester</h2><ul>
<li><p>mapping</p>
<pre><code>PUT music
{
    &quot;mappings&quot;: {
        &quot;_doc&quot; : {
            &quot;properties&quot; : {
                &quot;suggest&quot; : {
                    &quot;type&quot; : &quot;completion&quot;,
                    &quot;analyzer&quot; : &quot;simple&quot;,
                    &quot;search_analyzer&quot; : &quot;simple&quot;
                },
                &quot;title&quot; : {
                    &quot;type&quot;: &quot;keyword&quot;
                }
            }
        }
    }   
}
</code></pre></li>
<li><p>query ，_source 会影响查询效率</p>
<pre><code>POST music/_search?pretty
{
    &quot;_source&quot;: &quot;suggest&quot;,
    &quot;suggest&quot;: {
        &quot;song-suggest&quot; : {
            &quot;prefix&quot; : &quot;nir&quot;,
            &quot;completion&quot; : {
                &quot;field&quot; : &quot;suggest&quot;
            },
            &quot;size&quot;:10
        }
    }
}
</code></pre></li>
<li><p>Whether duplicate suggestions should be filtered out (defaults to false).</p>
<p>  The autocomplete suggester is document-oriented in Elasticsearch 5 and will thus return suggestions for all documents that match. In Elasticsearch 1 and 2, the autocomplete suggester automatically de-duplicated suggestions.</p>
<pre><code>POST music/_search?pretty
{
    &quot;_source&quot;: &quot;suggest&quot;,
    &quot;suggest&quot;: {
        &quot;song-suggest&quot; : {
            &quot;prefix&quot; : &quot;nir&quot;,
            &quot;completion&quot; : {
                &quot;field&quot; : &quot;suggest&quot;
            },
            &quot;size&quot;:10,
            &quot;skip_duplicates&quot;:true
        }
    }
}
</code></pre></li>
</ul>
<h2 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a>DSL</h2><ul>
<li><p>completion suggest sample</p>
<pre><code>s = s.suggest(&apos;my_sugestion&apos;, keyword, completion={ &apos;field&apos; : &apos;name&apos;, &apos;size&apos;:100})
</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/08/06/spider_court/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/06/spider_court/" itemprop="url">中国裁判文书网反爬机制更新</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-06T10:00:00+08:00">
                2018-08-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/06/spider_court/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/06/spider_court/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="关于更新"><a href="#关于更新" class="headerlink" title="关于更新"></a>关于更新</h3><p>2018年8月18日，更新一次反爬机制。这里做记录，仅作为以后参考。</p>
<ol>
<li>在列表页获取详情页链接过程中，DocID作了加密，只要做一次解密DocID即可。</li>
<li>AES双向对称加密，重点在与获取分发的密钥。</li>
</ol>
<h3 id="关于更新-1"><a href="#关于更新-1" class="headerlink" title="关于更新"></a>关于更新</h3><p>2018年8月15日，更新一次反爬机制。这里做记录，仅作为以后参考。</p>
<ol>
<li>vl5x的计算，计算vl5x的函数有修改。</li>
</ol>
<h3 id="关于更新-2"><a href="#关于更新-2" class="headerlink" title="关于更新"></a>关于更新</h3><p>2018年8月6日，更新一次反爬机制。这里做记录，仅作为以后参考。</p>
<ol>
<li><p>vl5x的计算，计算vl5x的函数相关函数又添加了一些。排查时最简单的方法就是用浏览器请求，拿到vjkl5，用现有解码的js函数执行得到结果和浏览器form里的vl5x进行比较。</p>
</li>
<li><p>在100页以内请求列表页过于频繁会跳验证码，想要成功验证，需要多次请求，一般十次以内。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/07/27/Scrapy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/27/Scrapy/" itemprop="url">Scrapy+Scrapyd+Redis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-27T14:05:00+08:00">
                2018-07-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/27/Scrapy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/27/Scrapy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Scrapy"><a href="#Scrapy" class="headerlink" title="Scrapy"></a>Scrapy</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre><code>pip install scrapy
</code></pre><ul>
<li><p>某些系统会找不到 Twisted ，需要手动下载<a href="https://files.pythonhosted.org/packages/90/50/4c315ce5d119f67189d1819629cae7908ca0b0a6c572980df5cc6942bc22/Twisted-18.7.0.tar.bz2" target="_blank" rel="noopener">source</a>，解压后再安装</p>
<pre><code>bzip2 -d Twisted-18.7.0.tar.bz2
pip3 install Twisted-18.7.0.tar
</code></pre></li>
</ul>
<h3 id="使用-scrapy-命令生成一个新的-project"><a href="#使用-scrapy-命令生成一个新的-project" class="headerlink" title="使用 scrapy 命令生成一个新的 project"></a>使用 scrapy 命令生成一个新的 project</h3><pre><code>scrapy startproject myproject

myproject/
    scrapy.cfg            # deploy configuration file

    myproject/             # project&apos;s Python module, you&apos;ll import your code from here
        __init__.py

        items.py          # project items definition file

        middlewares.py    # project middlewares file

        pipelines.py      # project pipelines file

        settings.py       # project settings file

        spiders/          # a directory where you&apos;ll later put your spiders
            __init__.py
</code></pre><h3 id="在-tutorial-spiders-目录下创建第一个-spider"><a href="#在-tutorial-spiders-目录下创建第一个-spider" class="headerlink" title="在 tutorial/spiders 目录下创建第一个 spider"></a>在 tutorial/spiders 目录下创建第一个 spider</h3><pre><code>import scrapy


class QuotesSpider(scrapy.Spider):
    name = &quot;quotes&quot;

    def start_requests(self):
        urls = [
            &apos;http://quotes.toscrape.com/page/1/&apos;,
            &apos;http://quotes.toscrape.com/page/2/&apos;,
        ]
        for url in urls:
            yield scrapy.Request(url=url, callback=self.parse)

    def parse(self, response):
        page = response.url.split(&quot;/&quot;)[-2]
        filename = &apos;quotes-%s.html&apos; % page
        with open(filename, &apos;wb&apos;) as f:
            f.write(response.body)
        self.log(&apos;Saved file %s&apos; % filename)
</code></pre><h3 id="运行-spider-，在-project-的根目录运行"><a href="#运行-spider-，在-project-的根目录运行" class="headerlink" title="运行 spider ，在 project 的根目录运行"></a>运行 spider ，在 project 的根目录运行</h3><pre><code>scrapy crawl quotes
</code></pre><h2 id="Scrapyd-，远程管理-Scrapy"><a href="#Scrapyd-，远程管理-Scrapy" class="headerlink" title="Scrapyd ，远程管理 Scrapy"></a>Scrapyd ，远程管理 Scrapy</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><pre><code>pip install scrapyd
</code></pre><h3 id="远程访问，修改配置文件-site-packages-scrapyd-default-scrapyd-conf"><a href="#远程访问，修改配置文件-site-packages-scrapyd-default-scrapyd-conf" class="headerlink" title="远程访问，修改配置文件 site-packages/scrapyd/default_scrapyd.conf"></a>远程访问，修改配置文件 site-packages/scrapyd/default_scrapyd.conf</h3><pre><code>bind_address = 0.0.0.0
</code></pre><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><pre><code>scrapyd
</code></pre><h3 id="Scrapy-project-部署到-Scrapyd"><a href="#Scrapy-project-部署到-Scrapyd" class="headerlink" title="Scrapy project 部署到 Scrapyd"></a>Scrapy project 部署到 Scrapyd</h3><ul>
<li>eggifying the project</li>
<li>uploading the egg to Scrapyd via the addversion.json</li>
<li>以上手动步骤可以通过 scrapyd-client 提供的 scrapyd-deploy 工具实现</li>
</ul>
<h3 id="安装-scrapyd-client"><a href="#安装-scrapyd-client" class="headerlink" title="安装 scrapyd-client"></a>安装 scrapyd-client</h3><pre><code>pip install scrapyd-client
</code></pre><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><pre><code>scrapyd-deploy &lt;target&gt; -p &lt;project&gt;
</code></pre><ul>
<li><p>可以编辑 scrapy.cfg 设置默认值，免于指定 target 和 project</p>
<pre><code>[deploy:target]
url = http://localhost:6800/
username = scrapy
password = secret
project = myproject
</code></pre></li>
<li><p>执行</p>
<pre><code>scrapyd-deploy target
</code></pre></li>
</ul>
<h3 id="schedule-a-spider-run"><a href="#schedule-a-spider-run" class="headerlink" title="schedule a spider run"></a>schedule a spider run</h3><pre><code>$ curl http://localhost:6800/schedule.json -d project=myproject -d spider=spider2
{&quot;status&quot;: &quot;ok&quot;, &quot;jobid&quot;: &quot;26d1b1a6d6f111e0be5c001e648c57f8&quot;}
</code></pre><h2 id="scrapy-redis-分布式"><a href="#scrapy-redis-分布式" class="headerlink" title="scrapy-redis 分布式"></a>scrapy-redis 分布式</h2><h3 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h3><pre><code>yum install redis
pip install scrapy-redis
</code></pre><h3 id="配置Redis-，编辑-etc-redis-conf"><a href="#配置Redis-，编辑-etc-redis-conf" class="headerlink" title="配置Redis ，编辑 /etc/redis.conf"></a>配置Redis ，编辑 /etc/redis.conf</h3><ul>
<li><p>设置访问密码</p>
<pre><code>requirepass password
</code></pre></li>
<li><p>注释 bind ，可远程访问</p>
<pre><code># bind 127.0.0.1 ::1
</code></pre></li>
</ul>
<h3 id="编辑-project-的-settings-py"><a href="#编辑-project-的-settings-py" class="headerlink" title="编辑 project 的 settings.py"></a>编辑 project 的 settings.py</h3><pre><code># Enables scheduling storing requests queue in redis.
SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;

# Ensure all spiders share same duplicates filter through redis.
DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;

# Store scraped item in redis for post-processing.
ITEM_PIPELINES = {
    &apos;scrapy_redis.pipelines.RedisPipeline&apos;: 300
}

# Specify the full Redis URL for connecting (optional).
# If set, this takes precedence over the REDIS_HOST and REDIS_PORT settings.
REDIS_URL = &apos;redis://user:password@host:6379&apos;
</code></pre><h3 id="运行-spider-，在-project-的根目录运行-1"><a href="#运行-spider-，在-project-的根目录运行-1" class="headerlink" title="运行 spider ，在 project 的根目录运行"></a>运行 spider ，在 project 的根目录运行</h3><pre><code>scrapy crawl quotes
</code></pre><h3 id="处理-Item"><a href="#处理-Item" class="headerlink" title="处理 Item"></a>处理 Item</h3><p>所有 Item 保存在 Redis ，key 为 quotes:items ，可以写脚本保存到数据库。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/06/12/spark-HelloWorld/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/12/spark-HelloWorld/" itemprop="url">Spark</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-12T17:46:35+08:00">
                2018-06-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/12/spark-HelloWorld/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/12/spark-HelloWorld/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul>
<li><p>安装JAVA</p>
<pre><code>$ java -version
</code></pre></li>
<li><p>安装Scala</p>
<pre><code>$ wget https://downloads.lightbend.com/scala/2.12.6/scala-2.12.6.rpm
$ sudo rpm -ivh scala-2.12.6.rpm
$ scala -version
</code></pre></li>
<li><p>安装Spark</p>
<pre><code>$ wget http://mirrors.hust.edu.cn/apache/spark/spark-2.3.1/spark-2.3.1-bin-hadoop2.7.tgz
$ tar xvf spark-2.3.1-bin-hadoop2.7.tgz
$ sudo mv spark-2.3.1-bin-hadoop2.7/* /usr/local/spark

$ vim ~/.bashrc
export PATH = $PATH:/usr/local/spark/bin
$ source ~/.bashrc

$ spark-shell
</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/06/10/scala-HelloWorld/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/10/scala-HelloWorld/" itemprop="url">Scala 基本语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-10T17:46:35+08:00">
                2018-06-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/10/scala-HelloWorld/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/10/scala-HelloWorld/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="函数和方法"><a href="#函数和方法" class="headerlink" title="函数和方法"></a>函数和方法</h4><pre><code>scala&gt; class C {
     |   var acc = 0
     |   def minc = { acc += 1 }
     |   val finc = { () =&gt; acc += 1 }
     | }
defined class C

scala&gt; val c = new C
c: C = C@1af1bd6

scala&gt; c.minc // calls c.minc()

scala&gt; c.finc // returns the function as a value:
res2: () =&gt; Unit = &lt;function0&gt;
</code></pre><h4 id="abstract-class"><a href="#abstract-class" class="headerlink" title="abstract class"></a>abstract class</h4><ul>
<li><p>不能实例化抽象类</p>
<pre><code>scala&gt; abstract class Shape{
|   def getArea():Int
| }
defined class Shape
</code></pre></li>
</ul>
<h4 id="Traits"><a href="#Traits" class="headerlink" title="Traits"></a>Traits</h4><pre><code>trait Car {
  val brand: String
}

trait Shiny {
  val shineRefraction: Int
}
class BMW extends Car {
  val brand = &quot;BMW&quot;
}

class BMW extends Car with Shiny {
  val brand = &quot;BMW&quot;
  val shineRefraction = 12
}
</code></pre><ul>
<li><p>优先使用特质。一个类扩展多个特质是很方便的，但却只能扩展一个抽象类。</p>
</li>
<li><p>如果你需要构造函数参数，使用抽象类。因为抽象类可以定义带参数的构造函数，而特质不行。例如，你不能说trait t(i: Int) {}，参数i是非法的。</p>
</li>
</ul>
<h4 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h4><p>Scala classes cannot have static variables or methods. Instead a Scala class can have what is called a singleton object, or sometime a companion object.</p>
<pre><code>scala&gt; class Bar(foo: String)
defined class Bar

scala&gt; object Bar{
     |   def apply(foo: String) = new Bar(foo)
     | }
</code></pre><h4 id="apply-方法，语法糖"><a href="#apply-方法，语法糖" class="headerlink" title="apply 方法，语法糖"></a>apply 方法，语法糖</h4><pre><code>scala&gt; class Foo{}
defined class Foo

scala&gt; object FooMaker{}
defined object FooMaker

scala&gt; object FooMaker{
     |   def apply() = new Foo
     | }
defined object FooMaker

scala&gt; val newFoo = FooMaker()
newFoo: Foo = Foo@229cb4d8
</code></pre><h4 id="函数即对象"><a href="#函数即对象" class="headerlink" title="函数即对象"></a>函数即对象</h4><p>函数是Function*特质的示例，并且定义了apply语法糖</p>
<pre><code>scala&gt; object addOne extends Function1[Int, Int]{
     |   def apply(m: Int): Int = m + 1
     | }
defined object addOne

scala&gt; addOne(1)
res0: Int = 2
</code></pre><h4 id="case-class"><a href="#case-class" class="headerlink" title="case class"></a>case class</h4><p>It makes only sense to define case classes if pattern matching is used to decompose data structures.</p>
<ul>
<li><p>实例化可以不加关键词new</p>
</li>
<li><p>toString更漂亮</p>
</li>
<li><p>默认实现equals和hashCode</p>
</li>
<li><p>默认序列化</p>
</li>
</ul>
<h4 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h4><ul>
<li><p>基本用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val times = 1</span><br><span class="line">times: Int = 1</span><br><span class="line"></span><br><span class="line">scala&gt; times match&#123;</span><br><span class="line">     |   case 1 =&gt; &quot;one&quot;</span><br><span class="line">     |   case 2 =&gt; &quot;two&quot;</span><br><span class="line">     |   case _ =&gt; &quot;other&quot;</span><br><span class="line">     | &#125;</span><br><span class="line">res2: String = one</span><br></pre></td></tr></table></figure>
</li>
<li><p>带if守卫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val score = 70</span><br><span class="line">score: Int = 70</span><br><span class="line"></span><br><span class="line">scala&gt; score match&#123;</span><br><span class="line">     |   case s if (score &gt;= 90) =&gt; &quot;优秀&quot;</span><br><span class="line">     |   case s if (score &gt;= 70) =&gt; &quot;良好&quot;</span><br><span class="line">     |   case s if (score &gt;= 60) =&gt; &quot;及格&quot;</span><br><span class="line">     |   case _ =&gt; &quot;不及格&quot;</span><br><span class="line">     | &#125;</span><br><span class="line">res5: String = 良好</span><br></pre></td></tr></table></figure>
</li>
<li><p>类型的模式匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try&#123;</span><br><span class="line">    something</span><br><span class="line">&#125;catch&#123;</span><br><span class="line">    case e: IllegalArgumentException=&gt; do something</span><br><span class="line">    case e: FileNotFoundException=&gt; do something</span><br><span class="line">    case e: IOException =&gt; do something</span><br><span class="line">    case _: Exception =&gt; do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>case class的模式匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Customer</span><br><span class="line">case class PersonalUser(name:String) extends Customer</span><br><span class="line">case class EnterpriseUser(name:String) extends Customer</span><br><span class="line">case class VipUser(name:String) extends Customer</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">def service(c:Customer):Unit=&#123;</span><br><span class="line">    c match&#123;</span><br><span class="line">      case EnterpriseUser(_)=&gt;print(&quot;Enterprise&quot;)</span><br><span class="line">      case PersonalUser(_)=&gt;print(&quot;Personal&quot;)</span><br><span class="line">      case VipUser(_)=&gt;print(&quot;Vip&quot;)</span><br><span class="line">      case _ =&gt;print(&quot;None&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Option的模式匹配</p>
<p>  Some and None are both children of Option</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def toInt(in: String): Option[Int] = &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        Some(Integer.parseInt(in.trim))</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">        case e: NumberFormatException =&gt; None</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">toInt(someString) match &#123;</span><br><span class="line">    case Some(i) =&gt; println(i)</span><br><span class="line">    case None =&gt; println(&quot;That didn&apos;t work.&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://thathub.com/2018/05/24/install-hive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jokers">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jokers's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/24/install-hive/" itemprop="url">Hive2安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-24T11:00:00+08:00">
                2018-05-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/24/install-hive/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/24/install-hive/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>适应版本Hadoop已安装，hdfs和yarn可以成功运行</p>
<h2 id="解压缩"><a href="#解压缩" class="headerlink" title="解压缩"></a>解压缩</h2><pre><code>$ sudo mv apache-hive-2.3.3-bin.tar.gz /usr/local/
$ cd /usr/local/
$ sudo tar -zxvf apache-hive-2.3.3-bin.tar.gz
$ sudo mv apache-hive-2.3.3-bin hive
$ sudo chown -R hadoop:hadoop hive
</code></pre><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><pre><code>$ vim ~/.bashrc
export HIVE_HOME=/usr/local/hive
export PATH=$PATH:$HIVE_HOME/bin
export CLASSPATH=$CLASSPATH:/usr/local/hadoop/lib/*:.
export CLASSPATH=$CLASSPATH:/usr/local/hive/lib/*:.

$ source ~/.bashrc
</code></pre><h2 id="Hive配置"><a href="#Hive配置" class="headerlink" title="Hive配置"></a>Hive配置</h2><pre><code>$ cp conf/hive-env.sh.template conf/hive-env.sh
$ vim conf/hive-env.sh
HADOOP_HOME=/usr/local/hadoop
export HIVE_CONF_DIR=/usr/local/hive/conf

$ cd /usr/local/hive
$ cp conf/hive-default.xml.template conf/hive-site.xml
$ vim conf/hive-size.xml
</code></pre><ul>
<li><p>system:java.io.tmpir &amp; system:user.name</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;system:java.io.tmpdir&lt;/name&gt;
    &lt;value&gt;/usr/local/hive/tmp&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;system:user.name&lt;/name&gt;
    &lt;value&gt;jokers&lt;/value&gt;
&lt;/property&gt;
</code></pre></li>
<li><p>mysql连接配置</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
    &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;description&gt;Driver class name for a JDBC metastore&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
    &lt;value&gt;jdbc:mysql://xx.xxx.xx.xx:3306/hive?createDatabaseIfNotExist=true&lt;/value&gt;
    &lt;description&gt;JDBC connect string for a JDBC metastore&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
    &lt;value&gt;hive&lt;/value&gt;
    &lt;description&gt;Username to use against metastore database&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
    &lt;value&gt;hive&lt;/value&gt;
    &lt;description&gt;password to use against metastore database&lt;/description&gt;
&lt;/property&gt;
</code></pre></li>
</ul>
<ul>
<li><p>hive的存储仓库位置，观察配置默认值</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;
    &lt;value&gt;/user/hive/warehouse&lt;/value&gt;
    &lt;description&gt;location of default database for the warehouse&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;hive.exec.scratchdir&lt;/name&gt;
    &lt;value&gt;/tmp/hive&lt;/value&gt;
    &lt;description&gt;HDFS root scratch dir for Hive jobs which gets created with write all (733) permission. For each connecting user, an HDFS scratch dir: ${hive.exec.scratchdir}/&lt;username&gt;is created, with ${hive.scratch.dir.permission}.&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;hive.querylog.location&lt;/name&gt;
    &lt;value&gt;${system:java.io.tmpdir}/${system:user.name}&lt;/value&gt;
    &lt;description&gt;Location of Hive run time structured log file&lt;/description&gt;
&lt;/property&gt;
</code></pre></li>
<li><p>使用Hadoop建立Hive仓库</p>
<pre><code>$ $HADOOP_HOME/bin/hadoop fs -mkdir /tmp/hive
$ $HADOOP_HOME/bin/hadoop fs -mkdir /user/hive/warehouse
$ $HADOOP_HOME/bin/hadoop fs -chmod g+w /tmp/hive
$ $HADOOP_HOME/bin/hadoop fs -chmod g+w /user/hive/warehouse
</code></pre></li>
<li><p>下载mysql-connector-java.jar</p>
<pre><code>$ sudo yum install mysql-connector-java.noarch
$ cp /usr/share/java/mysql-connector-java.jar $HIVE_HOME/lib/mysql-connector-java.jar
</code></pre></li>
</ul>
<ul>
<li><p>Hive初始化mysql数据库</p>
<pre><code>$ schematool --dbType mysql --initSchema
</code></pre></li>
<li><p>启动Hive</p>
<pre><code>$ hive
</code></pre></li>
</ul>
<h2 id="MySQL数据导入hive"><a href="#MySQL数据导入hive" class="headerlink" title="MySQL数据导入hive"></a>MySQL数据导入hive</h2><ul>
<li><p>安装Sqoop</p>
</li>
<li><p>配置mysqldump(如果使用–direct)</p>
<pre><code>ln -fs /user/local/mysql/bin/mysqldump /usr/bin
</code></pre></li>
<li><p>给Hadoop添加环境变量</p>
<pre><code>$ vim /usr/local/hadoop/etc/hadoop/hadoop-env.sh
export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:/usr/local/hive/conf/
export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:/usr/local/hive/lib/
# 不能这样写/usr/local/hive/conf/* /usr/local/hive/lib/*
</code></pre></li>
<li><p>导入示例</p>
<pre><code>sqoop import --connect jdbc:mysql://xx.xx.x.x:3306/databases --table table --username hive --password hive --direct --fields-terminated-by &apos;|&apos;  --warehouse-dir /user/hive/warehouse  --hive-import
</code></pre></li>
</ul>
<h2 id="远程链接hiveserver2"><a href="#远程链接hiveserver2" class="headerlink" title="远程链接hiveserver2"></a>远程链接hiveserver2</h2><ul>
<li><p>配置hive-site.xml</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;hive.server2.thrift.client.user&lt;/name&gt;
    &lt;value&gt;hadoop&lt;/value&gt;
    &lt;description&gt;Username to use against thrift client&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hive.server2.thrift.client.password&lt;/name&gt;
    &lt;value&gt;zcb1511&lt;/value&gt;
    &lt;description&gt;Password to use against thrift client&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hive.server2.transport.mode&lt;/name&gt;
    &lt;value&gt;binary&lt;/value&gt;
    &lt;description&gt;
        Expects one of [binary, http].
        Transport mode of HiveServer2.
    &lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hive.server2.thrift.port&lt;/name&gt;
    &lt;value&gt;10000&lt;/value&gt;
    &lt;description&gt;Port number of HiveServer2 Thrift interface when hive.server2.transport.mode is &apos;binary&apos;.&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;
    &lt;value&gt;0.0.0.0&lt;/value&gt;
    &lt;description&gt;Bind host on which to run the HiveServer2 Thrift service.&lt;/description&gt;
&lt;/property&gt;
</code></pre></li>
<li><p>配置hadoop下的core-site.xml</p>
<pre><code>&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.hadoop.hosts&lt;/name&gt;
    &lt;!--value&gt;master&lt;/value--&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;hadoop.proxyuser.hadoop.groups&lt;/name&gt;
    &lt;!--value&gt;hadoop&lt;/value--&gt;
    &lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;
</code></pre></li>
<li><p>启动hive服务,客户端可以使用beeline命令行，也可使用sql developer客户端工具，需要下载hive jdbc驱动</p>
<pre><code>nohup hiveserver2 &gt;hive.log 2&gt;&amp;1 &amp;
</code></pre></li>
</ul>
<h2 id="error解决"><a href="#error解决" class="headerlink" title="error解决"></a>error解决</h2><pre><code>hive.HiveConfig: Could not load org.apache.hadoop.hive.conf.HiveConf. Make sure HIVE_CONF_DIR is set correctly

$ vim ~/.bashrc
export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:/usr/local/hive/lib/*
$ source ~/.bashrc
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jokers" />
          <p class="site-author-name" itemprop="name">Jokers</p>
           
              <p class="site-description motion-element" itemprop="description">hlxstc680@gmail.com</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jokers</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://thathub-com.disqus.com.disqus.com/count.js" async></script>
    

    

  




	





  








  





  

  

  

  

  

  

</body>
</html>
